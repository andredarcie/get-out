<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <h1>Dungeon Crawler</h1>
    <canvas id="canvas" width="400" height="400" style="background-color: #2ecc71;"></canvas>
    <p>W, A, S, D to move. <span id="status">[]</span></p>
    <div
      class="fb-like"
      data-share="true"
      data-width="450"
      data-show-faces="true">
    </div>
    <script src="js/object.js"></script>
    <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '1434700419907771',
        xfbml      : true,
        version    : 'v2.8'
      });
      FB.AppEvents.logPageView();
      };

      (function(d, s, id){
       var js, fjs = d.getElementsByTagName(s)[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement(s); js.id = id;
       js.src = "//connect.facebook.net/en_US/sdk.js";
       fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));


      var $canvas = document.getElementById('canvas');
      var context = $canvas.getContext("2d");

      // listen for keydown events on the document
      document.addEventListener("keydown",handleKeydown,false);

      var map = [
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 0, 0, 0, 1, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
        [0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 1, 0]
      ];

      var player = new Object({
        type: '',
        row: 0,
        column: 0,
        color: '',
        layer: map
      });

      draw(map);

      var rowView = 0, columnView = 0;
      var viewX = 0, viewY = 0;

      function draw(layer){

        context.clearRect(0,0,$canvas.width,$canvas.height);

        for (var row = rowView; row < rowView+2; row++){
          viewX++;
          for (var column = columnView; column < columnView+2; column++){
            viewY++;
            if(layer[row][column] > 0){
              context.fillStyle = "#8e44ad";
              context.fillRect(viewY * 40, viewX * 40, 40, 40);
            }
          }
          viewY = 0;
        }

        document.getElementById('status').innerHTML =
                "[ " + player.column + ", " + player.row + " ]";

      }

      function handleKeydown(e){
        switch(e.keyCode){
          case 87: // W
              if (player.row-1 === -1) return;

              if (map[player.row-1][player.column] === 1){
                console.log("blocked");
              } else {
                player.moveUp(); rowView--;
              }
          break;
          case 83: // S
            if (player.row+1 === 10) return;

            if (map[player.row+1][player.column] === 1){
              console.log("blocked");
            } else {
              player.moveDown(); rowView++;
            }
          break;
          case 65: // A
            if (map[player.row][player.column-1] === 1 || (player.column-1) === -1){
              console.log("blocked");
            } else {
              player.moveLeft(); columnView--;
            }
          break;
          case 68: // D
            if (map[player.row][player.column+1] === 1 || (player.column+1) === 10){
              console.log("blocked");
            } else {
              player.moveRight(); columnView++;
            }
          break;
        }
        draw(map);
      }
    </script>
  </body>
</html>
