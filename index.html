<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <h1>Dungeon Crawler</h1>
    <canvas id="canvas" width="400" height="400" style="background-color: #2ecc71;"></canvas>
    <p>W, A, S, D to move. <span id="status">[]</span></p>
    <script src="js/object.js"></script>
    <script>
      var $canvas = document.getElementById('canvas');
      var context = $canvas.getContext("2d");

      // listen for keydown events on the document
      document.addEventListener("keydown",handleKeydown,false);

      var map = [
        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 1, 0, 0, 0, 1, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
        [0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [1, 0, 0, 1, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 1, 0]
      ];

      var player = new Object({
        type: 'player',
        row: 0,
        column: 0,
        color: '',
        layer: map
      });

      draw(map);

      function draw(layer){

        context.clearRect(0,0,$canvas.width,$canvas.height);

        for (var row = 0; row < layer.length; row++){
          for (var column = 0; column < layer[0].length; column++){
            if(layer[row][column] > 0){
              context.fillStyle = "#8e44ad";
              context.fillRect(column * 40, row * 40, 40, 40);
            }
          }
        }

        document.getElementById('status').innerHTML =
                "[ " + player.column + ", " + player.row + " ]";

      }

      function handleKeydown(e){
        switch(e.keyCode){
          case 87: // W
              if (player.row-1 === -1) return;

              if (map[player.row-1][player.column] === 1){
                console.log("blocked");
              } else {
                player.moveUp();
              }
          break;
          case 83: // S
            if (player.row+1 === 10) return;

            if (map[player.row+1][player.column] === 1){
              console.log("blocked");
            } else {
              player.moveDown();
            }
          break;
          case 65: // A
            if (map[player.row][player.column-1] === 1 || (player.column-1) === -1){
              console.log("blocked");
            } else {
              player.moveLeft();
            }
          break;
          case 68: // D
            if (map[player.row][player.column+1] === 1 || (player.column+1) === 10){
              console.log("blocked");
            } else {
              player.moveRight();
            }
          break;
        }
        draw(map);
      }
    </script>
  </body>
</html>
