parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"M2Er":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.GameStates=void 0,function(e){e[e.TRAVEL=0]="TRAVEL",e[e.CAMP=1]="CAMP",e[e.EVENT=2]="EVENT",e[e.SKILLCHECK=3]="SKILLCHECK",e[e.GAME_OVER=4]="GAME_OVER",e[e.RIP=5]="RIP",e[e.LOG=6]="LOG",e[e.BAG=7]="BAG",e[e.ITEM_PICKER=8]="ITEM_PICKER"}(e=exports.GameStates||(exports.GameStates={}));
},{}],"xGbl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CampManager=void 0;var e=require("../Game"),t=require("../enums/GameStates"),a=function(){function a(){var t=this;this._travelBtn=document.querySelector("#travel-btn"),this._restBtn=document.querySelector("#camp-rest-btn"),this._travelBtn.addEventListener("click",function(){t.onClickTravel()}),this._restBtn.addEventListener("click",function(){t.onClickRest()}),this._game=e.Game.getInstance()}return a.prototype.start=function(){},a.prototype.onClickTravel=function(){this._game.stateManager.goToState(t.GameStates.TRAVEL)},a.prototype.onClickRest=function(){for(var e=0;e<6;e++)this._game.passOneHour();this._game.characterManager.increaseStaminaOfAllCharacters(100)},a}();exports.CampManager=a;
},{"../Game":"LMN3","../enums/GameStates":"M2Er"}],"Yaha":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Event=exports.EventType=void 0,function(e){e[e.Exploration=0]="Exploration",e[e.Combat=1]="Combat",e[e.Place=2]="Place"}(e=exports.EventType||(exports.EventType={}));var t=function(){function e(e,t,n,r,o,i,p){this._items=[],this._name=e,this._description=t,this._image=n,this._onYes=r,this._onNo=o,this._type=i,this._items=p}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onYes",{get:function(){return this._onYes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onNo",{get:function(){return this._onNo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),e.prototype.willGiveItems=function(){return!!this._items&&this._items.length>0},e}();exports.Event=t;
},{}],"pbwm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LogManager=exports.LogType=void 0;var t,e=require("../Game"),a=require("../enums/GameStates");!function(t){t[t.Result=0]="Result",t[t.StatusChange=1]="StatusChange"}(t=exports.LogType||(exports.LogType={}));var s=function(){function s(){var t=this;this._tempResultLogs=[],this._tempoStatusChangeLogs=[],this._logs=[],this._game=e.Game.getInstance(),this._logListResult=document.querySelector("#log-list-result"),this._logListStatusChange=document.querySelector("#log-list-status-change"),this._travelBtn=document.querySelector("#log-back-character-btn"),this._travelBtn.addEventListener("click",function(){t.onClickTravel()})}return s.prototype.start=function(){this.showLogs()},s.prototype.showLogs=function(){for(var t="",e=0;e<this._tempResultLogs.length;e++)t+="<li>"+this._tempResultLogs[e]+"</li>";this._logs=this._tempResultLogs,this._tempResultLogs=[],this._logListResult.innerHTML=t,this._logs=this._tempoStatusChangeLogs,this._tempoStatusChangeLogs=[],this._logListStatusChange.innerHTML=this.createLogsForStatusChange(),this._game.characterManager.savePreviousCharacters()},s.prototype.createLogsForStatusChange=function(){for(var t=this._game.characterManager.previousCharacters,e=this._game.characterManager.characters,a="",s=0;s<t.length;s++){var r=t[s],o=e[s];o.isDead||r.health==o.health&&r.hungry==o.hungry&&r.stamina==o.stamina||(a+="<li> "+o.name+" ",r.health!=o.health&&(r.health>o.health?a+="‚ù§Ô∏è -"+(r.health-o.health)+"% ":a+="‚ù§Ô∏è +"+(o.health-r.health)+"% "),r.hungry!=o.hungry&&(r.hungry>o.hungry?a+="ü•´ -"+(r.hungry-o.hungry)+"% ":a+="ü•´ +"+(o.hungry-r.hungry)+"% "),r.stamina!=o.stamina&&(r.stamina>o.stamina?a+="‚ö° -"+(r.stamina-o.stamina)+"% ":a+="‚ö° +"+(o.stamina-r.stamina)+"% "),a+="</li>")}return a},s.prototype.clearLogs=function(){this._logListResult.innerHTML="",this._logListStatusChange.innerHTML=""},s.prototype.onClickTravel=function(){for(var t=0,e=this._game.characterManager.getCharactersDead();t<e.length;t++){var s=e[t];if(s.isDead&&!s.buried)return void this._game.stateManager.goToState(a.GameStates.RIP)}this._game.stateManager.goToState(a.GameStates.TRAVEL)},s.prototype.isThereAnyTemporaryLog=function(){return this._tempResultLogs.length>0||this._tempoStatusChangeLogs.length>0},s.prototype.addTempLog=function(e,a){a==t.Result?this._tempResultLogs.push(e):a==t.StatusChange&&this._tempoStatusChangeLogs.push(e),this._game.addLogToFirebase(e)},s}();exports.LogManager=s;
},{"../Game":"LMN3","../enums/GameStates":"M2Er"}],"hFLE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DiceManager=void 0;var e=function(){function e(){}return e.prototype.start=function(){},e.prototype.getDifficultLevel=function(e){return e<2?"Trivial":e<=4?"Easy":e<=6?"Medium":e<=8?"Challenging":e<=10?"Very Hard":e<=12?"Impossibile":void 0},e}();exports.DiceManager=e;
},{}],"Zpuy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Dice=void 0;var t=function(){function t(){}return t.prototype.roll=function(){var t=Math.ceil(1),e=Math.floor(6);return Math.floor(Math.random()*(e-t+1))+t},t}();exports.Dice=t;
},{}],"Qoi8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SkillCheckManager=exports.SkillCheckResults=void 0;var e,s=require("../entities/Dice"),i=require("../Game"),t=require("../enums/GameStates");!function(e){e[e.Success=0]="Success",e[e.CriticialSuccess=1]="CriticialSuccess",e[e.Failure=2]="Failure",e[e.CriticalFailure=3]="CriticalFailure"}(e=exports.SkillCheckResults||(exports.SkillCheckResults={}));var l=function(){function l(){var e=this;this._game=i.Game.getInstance(),this._resultLabel=document.querySelector("#skill-check-result-label"),this._skillCheckResultValue=document.querySelector("#skill-check-result-value"),this._skillCheckResultValueLabel=document.querySelector("#skill-check-result-value-label"),this._travelBtn=document.querySelector("#skill-check-back-btn"),this._firstDice=document.querySelector("#first-dice"),this._secondDice=document.querySelector("#second-dice"),this._skillCheckExpected=document.querySelector("#skill-check-expected"),this._travelBtn.addEventListener("click",function(){e.onClickTravel()})}return l.prototype.start=function(){var e=this,i=new s.Dice;this._resultLabel.style.visibility="hidden",this._diceTimer=setInterval(function(){e.shakeDice(i)},50),setTimeout(function(){e.stopShakeDice(i)},500)},l.prototype.onClickTravel=function(){this._game.events.currentEvent.onYes.callback(),this._game.stateManager.goToState(t.GameStates.LOG)},l.prototype.shakeDice=function(e){var s=e.roll(),i=e.roll();this.showDiceValues(s,i)},l.prototype.stopShakeDice=function(s){clearInterval(this._diceTimer),this._resultLabel.style.visibility="visible";var i=s.roll(),t=s.roll(),l=this._game.skillCheckDifficultie,c=i+t+3;return this.showDiceValues(i,t),this._skillCheckResultValue.style.textAlign="center",this._skillCheckResultValue.innerHTML=c.toString(),this._skillCheckExpected.innerHTML="Expected: "+l.toString(),i+t==12?(this.setCriticalSuccess(),void(this._game.skillCheckResult=e.CriticialSuccess)):i+t==2?(this.setCriticalFailure(),void(this._game.skillCheckResult=e.CriticalFailure)):c>=l?(this.setSuccess(),void(this._game.skillCheckResult=e.Success)):c<l?(this.setFailure(),void(this._game.skillCheckResult=e.Failure)):void 0},l.prototype.showDiceValues=function(e,s){this._firstDice.innerHTML=e.toString(),this._secondDice.innerHTML=s.toString()},l.prototype.setCriticalSuccess=function(){this._skillCheckResultValue.style.visibility="hidden",this._skillCheckResultValueLabel.style.visibility="hidden",this._skillCheckResultValue.classList.remove("red-color"),this._skillCheckResultValue.classList.add("green-color"),this._firstDice.classList.add("green-color"),this._secondDice.classList.add("green-color"),this._firstDice.classList.remove("red-color"),this._secondDice.classList.remove("red-color"),this._resultLabel.innerHTML="[ CRITICIAL SUCCESS ]",this._resultLabel.style.fontSize="1.3em",this._resultLabel.classList.remove("red-color"),this._resultLabel.classList.add("green-color")},l.prototype.setSuccess=function(){this._skillCheckResultValue.style.visibility="visible",this._skillCheckResultValueLabel.style.visibility="visible",this._skillCheckResultValue.classList.remove("red-color"),this._skillCheckResultValue.classList.add("green-color"),this._firstDice.classList.remove("green-color"),this._secondDice.classList.remove("green-color"),this._firstDice.classList.remove("red-color"),this._secondDice.classList.remove("red-color"),this._resultLabel.innerHTML="[ SUCCESS ]",this._resultLabel.style.fontSize="2.5em",this._resultLabel.classList.remove("red-color"),this._resultLabel.classList.add("green-color")},l.prototype.setCriticalFailure=function(){this._skillCheckResultValue.style.visibility="hidden",this._skillCheckResultValueLabel.style.visibility="hidden",this._skillCheckResultValue.classList.add("red-color"),this._skillCheckResultValue.classList.remove("green-color"),this._firstDice.classList.remove("green-color"),this._secondDice.classList.remove("green-color"),this._firstDice.classList.add("red-color"),this._secondDice.classList.add("red-color"),this._resultLabel.innerHTML="[ CRITICIAL FAILURE ]",this._resultLabel.style.fontSize="1.3em",this._resultLabel.classList.add("red-color"),this._resultLabel.classList.remove("green-color")},l.prototype.setFailure=function(){this._skillCheckResultValue.style.visibility="visible",this._skillCheckResultValueLabel.style.visibility="visible",this._skillCheckResultValue.classList.add("red-color"),this._skillCheckResultValue.classList.remove("green-color"),this._firstDice.classList.remove("green-color"),this._secondDice.classList.remove("green-color"),this._firstDice.classList.remove("red-color"),this._secondDice.classList.remove("red-color"),this._resultLabel.innerHTML="[ FAILURE ]",this._resultLabel.style.fontSize="2.5em",this._resultLabel.classList.add("red-color"),this._resultLabel.classList.remove("green-color")},l}();exports.SkillCheckManager=l;
},{"../entities/Dice":"Zpuy","../Game":"LMN3","../enums/GameStates":"M2Er"}],"jkJc":[function(require,module,exports) {
"use strict";var o;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Afflictions=void 0,function(o){o[o.BloodLoss=0]="BloodLoss",o[o.BrokenRibs=1]="BrokenRibs",o[o.Pain=2]="Pain",o[o.Anxiety=3]="Anxiety",o[o.Fear=4]="Fear",o[o.Depressed=5]="Depressed",o[o.Dysentery=6]="Dysentery",o[o.FoodPoisoning=7]="FoodPoisoning",o[o.Infection=8]="Infection",o[o.Wounds=9]="Wounds"}(o=exports.Afflictions||(exports.Afflictions={}));
},{}],"Ga92":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventSeeds=void 0;var e=require("../entities/Event"),t=require("../Game"),a=require("../managers/LogManager"),n=require("../managers/DiceManager"),o=require("../entities/Dice"),r=require("../managers/SkillCheckManager"),l=require("../enums/Afflictions"),i=function(){function i(){this._imageUrlList=[],this._game=t.Game.getInstance();for(var e=0;e<8;e++)this._imageUrlList[e]=document.getElementById("event-page-image-"+(e+1)).src;this._events=[]}return i.prototype.start=function(){var t=this;this.events.push(new e.Event("Wild Wolf Appeared","He jumps furiously wanting blood!","",{buttonText:"Throw a stone",skillCheck:!1,callback:function(){t._game.log.addTempLog("You hit the rock and killed the wolf!",a.LogType.Result)}},{buttonText:"Run like a chicken",skillCheck:!1,callback:function(){t._game.log.addTempLog("Did you get away",a.LogType.Result)}},e.EventType.Combat,null))},Object.defineProperty(i.prototype,"events",{get:function(){return this._events},enumerable:!1,configurable:!0}),i.prototype.getPlaceEvent=function(){var t=this,n=["Abandoned warehouse","Strange building","Very old house","Abandoned supermarket","Bus stop","Abandoned hospital","Abandoned Department Store","Strange Fire department","Musem","Very old Mall","School","Movie Theater","Very old Video Store","Abandoned Police Station"],o=["Explore","Inspect","Investigate","Search","Take a look at"],r=["You didnt find anything useful","You find a lot of useless garbage","Nothing important was found","Unfortunately this place was totally empty","Looks like someone already got everything they had here","All things are burned, nothing can be recovered"],i=n[this._game.getRandomArbitrary(n.length-1)],s=o[this._game.getRandomArbitrary(o.length-1)],u=(this._game.getRandomArbitrary(r.length-1),this._imageUrlList[this._game.getRandomArbitrary(this._imageUrlList.length-2)]),g=this.randomEnum(l.Afflictions);return new e.Event(i,"No sign of life",u,{buttonText:s,skillCheck:!1,callback:function(){t._game.characterManager.picksACharacterAtRandom().addAffliction(g)}},{buttonText:"Ignore",skillCheck:!1,callback:function(){t._game.log.addTempLog("You just ignored",a.LogType.Result)}},e.EventType.Place,null)},i.prototype.randomEnum=function(e){var t=Object.keys(e).map(function(e){return Number.parseInt(e)}).filter(function(e){return!Number.isNaN(e)});return t[Math.floor(Math.random()*t.length)]},i.prototype.getCombatEvent=function(){var t=this,l=["Wolf","Timberwolf","Bear","Mercenary","Bandit"],i=(new o.Dice,this._game.getRandomArbitrary(l.length-1),new n.DiceManager);return this._game.skillCheckDifficultie=10,i.getDifficultLevel(10),new e.Event("Furious wolf appeared!","You are in trouble",this._imageUrlList[6],{buttonText:"Fight ["+i.getDifficultLevel(10)+": 10]",skillCheck:!0,callback:function(){var e=t._game.skillCheckResult;e==r.SkillCheckResults.Success?t._game.log.addTempLog("With a lot of struggle you beat the wolf",a.LogType.Result):e==r.SkillCheckResults.Failure?(t._game.log.addTempLog("The wolf has hurt you",a.LogType.Result),t._game.characterManager.decreasesTheHealthOfSomeoneInTheGroup()):e==r.SkillCheckResults.CriticialSuccess?t._game.log.addTempLog("You defeated the wolf easily",a.LogType.Result):(e=r.SkillCheckResults.CriticalFailure)&&(t._game.log.addTempLog("The wolf left you devastated",a.LogType.Result),t._game.characterManager.decreasesTheHealthOfSomeoneInTheGroup(),t._game.characterManager.decreasesTheHealthOfSomeoneInTheGroup())}},{buttonText:"Try to escape",skillCheck:!0,callback:function(){t._game.log.addTempLog("You just ignored",a.LogType.Result)}},e.EventType.Combat,null)},i.prototype.getMileStoneEvent=function(){return new e.Event("Milestone Reached! ",this._game.distanceToTheBorder+" miles to the border",this._imageUrlList[7],{buttonText:"Back to travel",skillCheck:!1,callback:function(){}},{buttonText:"Back to travel",skillCheck:!1,callback:function(){}},e.EventType.Exploration,null)},i}();exports.EventSeeds=i;
},{"../entities/Event":"Yaha","../Game":"LMN3","../managers/LogManager":"pbwm","../managers/DiceManager":"hFLE","../entities/Dice":"Zpuy","../managers/SkillCheckManager":"Qoi8","../enums/Afflictions":"jkJc"}],"XVIc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventManager=void 0;var e=require("../entities/Event"),t=require("../Game"),n=require("../seeds/EventSeeds"),i=require("../enums/GameStates"),s=function(){function s(){var e=this;this._titleElement=document.getElementById("event-page-title"),this._descriptionElement=document.getElementById("event-page-description"),this._imageElement=document.getElementById("event-page-image"),this._yesButton=document.getElementById("event-page-yes-btn"),this._noButton=document.getElementById("event-page-no-btn"),this._yesButton.addEventListener("click",function(){e.onEventPageYesBtn()}),this._noButton.addEventListener("click",function(){e.onEventPageNoBtn()}),this._game=t.Game.getInstance()}return s.prototype.start=function(){var e=new n.EventSeeds;e.start();e.events;var t=this._game.getRandomArbitrary(2);this.checkForMileStone()?this._currentEvent=e.getMileStoneEvent():this._currentEvent=0==t?e.getCombatEvent():e.getPlaceEvent(),this.showWaitingMessage()},Object.defineProperty(s.prototype,"currentEvent",{get:function(){return this._currentEvent},enumerable:!1,configurable:!0}),s.prototype.checkForMileStone=function(){return 250==this._game.distanceToTheBorder||200==this._game.distanceToTheBorder||150==this._game.distanceToTheBorder||100==this._game.distanceToTheBorder||50==this._game.distanceToTheBorder},s.prototype.showWaitingMessage=function(){var e=this;this._titleElement.style.display="none",this._descriptionElement.innerHTML="Something happened!",this._imageElement.style.display="none",this._yesButton.style.display="none",this._noButton.style.display="none",setTimeout(function(){return e.showEvent()},1e3)},s.prototype.showEvent=function(){this._titleElement.style.display="block",this._titleElement.innerHTML=this._currentEvent.name,this._descriptionElement.innerHTML=this._currentEvent.description,""!=this._currentEvent.image&&(this._imageElement.src=this._currentEvent.image),this._imageElement.style.display="block",this.showButtons()},s.prototype.showButtons=function(){this._yesButton.style.display="inline-block",this._noButton.style.display="inline-block",this._yesButton.innerHTML=this._currentEvent.onYes.buttonText,this._noButton.innerHTML=this._currentEvent.onNo.buttonText},s.prototype.onEventPageYesBtn=function(){if(this._currentEvent.onYes.skillCheck)this._game.stateManager.goToState(i.GameStates.SKILLCHECK);else{if(this._currentEvent.type==e.EventType.Place)return this._currentEvent.onYes.callback(),void this._game.stateManager.goToState(i.GameStates.ITEM_PICKER);this._currentEvent.onYes.callback(),this.checkLogs()}},s.prototype.onEventPageNoBtn=function(){this._currentEvent.onNo.callback(),this.checkLogs()},s.prototype.checkLogs=function(){this._game.log.isThereAnyTemporaryLog()?this._game.stateManager.goToState(i.GameStates.LOG):this._game.stateManager.goToState(i.GameStates.TRAVEL)},s}();exports.EventManager=s;
},{"../entities/Event":"Yaha","../Game":"LMN3","../seeds/EventSeeds":"Ga92","../enums/GameStates":"M2Er"}],"te8u":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GameOverManager=void 0;var e=require("../Game"),t=function(){function t(){this._game=e.Game.getInstance(),this._gameOverMessage=document.querySelector("#game-over-message"),this._tryAgainBtn=document.querySelector("#try-again-btn")}return t.prototype.start=function(){var e=this;this._tryAgainBtn.addEventListener("click",function(){e.onClickTryAgainBtn()}),this.setGameOverMessage("You died with "+this._game.distanceToTheBorder+" miles to the border")},t.prototype.onClickTryAgainBtn=function(){location.reload()},t.prototype.setGameOverMessage=function(e){this._gameOverMessage.innerHTML=e},t}();exports.GameOverManager=t;
},{"../Game":"LMN3"}],"NjyG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RipManager=void 0;var e=require("../Game"),t=require("../enums/GameStates"),a=function(){function a(){var t=this;this._game=e.Game.getInstance(),this._ripPageImageElement=document.querySelector("#rip-page-image"),this._ripPageNameElement=document.querySelector("#rip-page-name"),this._ripPageDatesElement=document.querySelector("#rip-page-dates"),this._ripPageQuoteElement=document.querySelector("#rip-page-quote"),this._ripPageStatusElement=document.querySelector("#rip-page-status"),this._travelBtn=document.querySelector("#rip-page-back-btn"),this._travelBtn.addEventListener("click",function(){t.onClickTravel()})}return a.prototype.start=function(){var e=this._game.characterManager.getFirstCharacterDeadAndNotBuried();this.showCharater(e),e.buried=!0},a.prototype.showCharater=function(e){this._ripPageImageElement.src=e.imageURL,this._ripPageNameElement.innerHTML=e.name+" Miller",this._ripPageDatesElement.innerHTML="‚≠ê 02/02/1996 - 20/03/2020 ‚úùÔ∏è",this._ripPageQuoteElement.innerHTML="I pray you find peace and rest wherever you are",this._ripPageStatusElement.innerHTML='<span style="font-weight: bold;">Status:</span> Starved to death'},a.prototype.onClickTravel=function(){var e=this._game.characterManager.getFirstCharacterDeadAndNotBuried();null!=e?(this.showCharater(e),e.buried=!0):this._game.stateManager.goToState(t.GameStates.TRAVEL)},a}();exports.RipManager=a;
},{"../Game":"LMN3","../enums/GameStates":"M2Er"}],"B4ph":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TravelManager=void 0;var e=require("../Game"),t=require("../enums/GameStates"),a=require("../managers/LogManager"),r=function(){function r(){var t=this;this._game=e.Game.getInstance(),this._travelledDistanceField=document.querySelector("#travelled-distance"),this._progressBar=document.getElementById("progress-bar"),this._walkBtn=document.querySelector("#walk-btn"),this._campBtn=document.querySelector("#camp-btn"),this._walkBtn.addEventListener("click",function(){t.onClickWalkBtn()}),this._campBtn.addEventListener("click",function(){t.onClickCampBtn()}),this.showTravelledDistance(),this._charactersList=[],this._bagBtn=document.querySelector("#bag-btn"),this._bagBtn.addEventListener("click",function(){t.onClickBag()}),this.getAtributesPageElements()}return r.prototype.start=function(){this._game.bagManager.isEmpty()?(this._bagBtn.innerHTML="Bag is empty",this._bagBtn.disabled=!0):(this._bagBtn.disabled=!1,this._bagBtn.innerHTML="Open bag ("+this._game.bagManager.showQuantityOfItems()+") "),this.showCharacters()},r.prototype.onClickWalkBtn=function(){if(this._game.passOneHour(),this.walkOneHour(),this.checkEvent())this._game.stateManager.goToState(t.GameStates.EVENT);else if(this._game.log.isThereAnyTemporaryLog()){var e=this._game.characterManager.picksACharacterAtRandom(),r=[e.name+" is feeling anxious...",e.name+" is thoughtful...",e.name+" feels a tightness in the heart...","The family continued walking...","The walk was smooth...","Nothing different..."],i=r[this._game.getRandomArbitrary(r.length-1)];this._game.log.addTempLog(i,a.LogType.Result),this._game.stateManager.goToState(t.GameStates.LOG)}},r.prototype.onClickBag=function(){this._game.stateManager.goToState(t.GameStates.BAG)},r.prototype.onClickCampBtn=function(){this._game.passOneHour(),this._game.stateManager.goToState(t.GameStates.CAMP)},r.prototype.getAtributesPageElements=function(){this._charactersList[0]={},this._charactersList[0].nameField=document.querySelector("#first-character-name-field"),this._charactersList[0].atributesField=document.querySelector("#first-character-atributes-field"),this._charactersList[0].afflictionsField=document.querySelector("#first-character-afflictions-field"),this._charactersList[1]={},this._charactersList[1].nameField=document.querySelector("#second-character-name-field"),this._charactersList[1].atributesField=document.querySelector("#second-character-atributes-field"),this._charactersList[1].afflictionsField=document.querySelector("#second-character-afflictions-field"),this._charactersList[2]={},this._charactersList[2].nameField=document.querySelector("#third-character-name-field"),this._charactersList[2].atributesField=document.querySelector("#third-character-atributes-field"),this._charactersList[2].afflictionsField=document.querySelector("#third-character-afflictions-field"),this._charactersList[3]={},this._charactersList[3].nameField=document.querySelector("#fourth-character-name-field"),this._charactersList[3].atributesField=document.querySelector("#fourth-character-atributes-field"),this._charactersList[3].afflictionsField=document.querySelector("#fourth-character-afflictions-field")},r.prototype.showCharacters=function(){for(var e=this._game.characters,t=0;t<e.length;t++){var a=e[t];a.isDead?(this._charactersList[t].nameField.innerHTML=a.name+" - "+a.kinship+" üíÄ",this._charactersList[t].atributesField.innerHTML=a.getDateOfBirth()+" - 2020"):(this._charactersList[t].nameField.innerHTML=a.name+" - "+a.kinship,this._charactersList[t].nameField.innerHTML+="Sick"==a.getSickness()?" [ Sick ]":"",this._charactersList[t].atributesField.innerHTML=a.getHealth()+" "+a.getStamina()+" "+a.getHungry(),this._charactersList[t].afflictionsField.innerHTML=a.showAfflictions())}},r.prototype.checkEvent=function(){return this.getRandomArbitrary(1,100)<=100},r.prototype.getRandomArbitrary=function(e,t){return Math.random()*(t-e)+e},r.prototype.walkOneHour=function(){this._game.characterManager.decreaseStaminaOfAllCharacters(5),this._game.characterManager.increaseHungryOfAllCharacters();for(var e=0,t=this._game.characterManager.getCharactersAlive();e<t.length;e++){var r=t[e];this._game.log.addTempLog(r.name+" ü•´ -5%  ‚ö° -5%",a.LogType.StatusChange)}this._game.decreaseTheDistanceToTheBorder(2),this.increaseProgressBar(),this._game.addLogToFirebase("Walk one hour"),this.showTravelledDistance(),this._game.distanceToTheBorder<=0&&this.arrivedAtTheBorder()},r.prototype.increaseProgressBar=function(){var e=300-this._game.distanceToTheBorder;this._progressBar.style.width=1*e+"px"},r.prototype.getRandomCharacter=function(){return Math.floor(Math.random()*this._game.characters.length)},r.prototype.showTravelledDistance=function(){this._travelledDistanceField.innerHTML=this._game.distanceToTheBorder+" miles to the border"},r.prototype.arrivedAtTheBorder=function(){this._game.stateManager.goToState(t.GameStates.GAME_OVER)},r}();exports.TravelManager=r;
},{"../Game":"LMN3","../enums/GameStates":"M2Er","../managers/LogManager":"pbwm"}],"SNDR":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Item=exports.ItemType=void 0,function(e){e[e.FirstAid=0]="FirstAid",e[e.Food=1]="Food",e[e.Drink=2]="Drink"}(e=exports.ItemType||(exports.ItemType={}));var t=function(){function t(e,t,o,n){void 0===n&&(n=[]),this._afflictions=[],this._name=e,this._type=t,this._amount=0,this._effectValue=o,this._afflictions=n}return Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"amount",{get:function(){return this._amount},set:function(e){this._amount=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afflictions",{get:function(){return this._afflictions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"effect",{get:function(){var t="";switch(this._type){case e.FirstAid:t+="‚ù§Ô∏è";break;case e.Food:t+="ü•´"}return t+=" +"+this.effectValue+"%"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"effectValue",{get:function(){return this._effectValue},enumerable:!1,configurable:!0}),t.prototype.showAmount=function(){return this._amount>1?" x "+this._amount:""},t.prototype.decreaseAmount=function(){this._amount--},t.prototype.increaseAmount=function(){this._amount++},t}();exports.Item=t;
},{}],"hQTy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BagManager=void 0;var e=require("../Game"),t=require("../entities/Item"),n=require("../enums/GameStates"),s=function(){function s(){var t=this;this._items=[],this._game=e.Game.getInstance(),this._itemListElement=document.querySelector("#bag-item-list"),this._selectedItemElement=document.getElementById("bag-selected-item"),this._bagCloseBtn=document.querySelector("#bag-close-btn"),this._bagThrowAwayBtn=document.getElementById("bag-throw-away-btn"),this._bagCloseBtn.addEventListener("click",function(){t.onClickBagClose()}),this._bagThrowAwayBtn.addEventListener("click",function(){t.onClickThrowAway()})}return s.prototype.start=function(){this.hideSelectedItem(),this.showItems(),this._bagThrowAwayBtn.style.display="none"},s.prototype.onClickBagClose=function(){this._game.stateManager.goToState(n.GameStates.TRAVEL)},s.prototype.onClickThrowAway=function(){this.removeOrDecreaseItem(),this._itemListElement.innerHTML="",this._selectedItemElement.style.display="none",this.showItems(),this._bagThrowAwayBtn.style.display="none"},s.prototype.hideSelectedItem=function(){this._selectedItemElement.innerHTML="",this._selectedItemElement.style.display="none"},s.prototype.showSelectedItem=function(){this._selectedItemElement.style.display="block"},s.prototype.showItems=function(){var e=this;if(this._itemListElement.innerHTML="",0!=this._items.length)for(var t=function(t){var s=document.createElement("li"),i=document.createElement("button");i.appendChild(document.createTextNode(t.name+" ("+t.effect+") "+t.showAmount())),i.addEventListener("click",function(){return e.selectItem(t)}),s.appendChild(i),n._itemListElement.appendChild(s)},n=this,s=0,i=this._items;s<i.length;s++){t(i[s])}else this._itemListElement.innerHTML="Empty"},s.prototype.putItem=function(e){var t=this._items.findIndex(function(t){return t.name==e.name});t>=0?this._items[t].increaseAmount():this._items.push(e)},s.prototype.showCharacters=function(){for(var e,n=this,s=function(s){var o=document.createElement("li"),m=document.createElement("button"),r=s.name;if(e=document.createElement("p"),s.isDead)m.disabled=!0,e.classList.add("line"),e.style.color="#2c3e50";else switch(i._selectedItem.type){case t.ItemType.FirstAid:r+=s.getHealth();break;case t.ItemType.Food:r+=s.getHungry()}e.appendChild(document.createTextNode(r)),m.appendChild(e),m.addEventListener("click",function(){return n.useItem(s)}),o.appendChild(m),i._itemListElement.appendChild(o)},i=this,o=0,m=this._game.characters;o<m.length;o++){s(m[o])}},s.prototype.selectItem=function(e){this._selectedItem=e,this._itemListElement.innerHTML="",this._selectedItemElement.innerHTML="Give "+this._selectedItem.name+" "+this._selectedItem.effect+" to:",this.showSelectedItem(),this.showCharacters(),this._bagThrowAwayBtn.style.display="block"},s.prototype.useItem=function(e){switch(this.removeOrDecreaseItem(),this.hideSelectedItem(),this.showItems(),this._selectedItem.type){case t.ItemType.FirstAid:e.increaseHealth(this._selectedItem.effectValue);break;case t.ItemType.Food:e.decreaseHungry(this._selectedItem.effectValue)}e.decreaseHungry(12),this._bagThrowAwayBtn.style.display="none"},s.prototype.removeOrDecreaseItem=function(){this._selectedItem.amount>1?this._selectedItem.decreaseAmount():this.removeItem(this._selectedItem.name)},s.prototype.removeItem=function(e){this._items=this._items.filter(function(t){return t.name!==e})},s.prototype.checksIfAnItemExists=function(e){return-1!=this._items.findIndex(function(t){return t.name==e})},s.prototype.isEmpty=function(){return this._items.length<=0},s.prototype.showQuantityOfItems=function(){for(var e=0,t=0;t<this._items.length;t++)e+=0==this._items[t].amount?1:this._items[t].amount;return e},s}();exports.BagManager=s;
},{"../Game":"LMN3","../entities/Item":"SNDR","../enums/GameStates":"M2Er"}],"G1mS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StateManager=void 0;var e=require("../Game"),a=require("../enums/GameStates"),t=function(){function t(){this.currentState=a.GameStates.TRAVEL,this._game=e.Game.getInstance()}return t.prototype.start=function(){},t.prototype.setState=function(){switch(this._game.hideAllPages(),this.currentState){case a.GameStates.TRAVEL:this._game.showPage(this._game.travelPage),this._game.travelManager.start();break;case a.GameStates.CAMP:this._game.showPage(this._game.campPage),this._game.campManager.start();break;case a.GameStates.EVENT:this._game.showPage(this._game.eventPage),this._game.eventManager.start();break;case a.GameStates.SKILLCHECK:this._game.showPage(this._game.skillCheckPage),this._game.skillCheckManager.start();break;case a.GameStates.LOG:this._game.showPage(this._game.logPage),this._game.logManager.start();break;case a.GameStates.GAME_OVER:this._game.showPage(this._game.gameOverPage),this._game.gameOverManager.start();break;case a.GameStates.RIP:this._game.showPage(this._game.ripPage),this._game.ripManager.start();break;case a.GameStates.BAG:this._game.showPage(this._game.bagPage),this._game.bagManager.start();break;case a.GameStates.ITEM_PICKER:this._game.showPage(this._game.itemPickerPage),this._game.itemPickerManager.start()}},t.prototype.goToState=function(e){this.currentState!=a.GameStates.GAME_OVER&&(this.currentState=e,this.setState())},t}();exports.StateManager=t;
},{"../Game":"LMN3","../enums/GameStates":"M2Er"}],"X9QG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Character=void 0;var t=require("../Game"),e=require("../managers/LogManager"),i=require("../enums/GameStates"),n=require("../enums/Afflictions"),r=function(){function r(e,i,n,r,o,s,a){void 0===n&&(n=100),void 0===r&&(r=100),void 0===o&&(o=100),this._health=100,this._stamina=100,this._hungry=100,this._afflictions=[],this._isDead=!1,this._buried=!1,this._sick=!1,this._name=e,this._kinship=i,this._health=n,this._stamina=r,this._hungry=o,this._dateOfBirth=s,this._isDead=a,this._game=t.Game.getInstance()}return Object.defineProperty(r.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isDead",{get:function(){return this._isDead},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"health",{get:function(){return this._health},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"stamina",{get:function(){return this._stamina},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"kinship",{get:function(){return this._kinship},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hungry",{get:function(){return this._hungry},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"buried",{get:function(){return this._buried},set:function(t){this._buried=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"imageURL",{get:function(){return this._imageURL},set:function(t){this._imageURL=t},enumerable:!1,configurable:!0}),r.prototype.addAffliction=function(t){this._game.logManager.addTempLog(this._name+" got: "+this.getAfflictionText(t),e.LogType.Result),this._afflictions.push(t)},r.prototype.removeAffliction=function(t){this._afflictions=this._afflictions.filter(function(e){return e!==t})},r.prototype.showAfflictions=function(){if(0==this._afflictions.length)return"";for(var t="",e=0,i=this._afflictions;e<i.length;e++){var n=i[e];t+=this.getAfflictionText(n)}return t},r.prototype.getAfflictionText=function(t){switch(t){case n.Afflictions.Anxiety:return" [ Anxiety ] ";case n.Afflictions.BloodLoss:return" [ Blood Loss ] ";case n.Afflictions.BrokenRibs:return" [ Broken Ribs ] ";case n.Afflictions.Depressed:return" [ Depressed ] ";case n.Afflictions.Dysentery:return" [ Dysentery ] ";case n.Afflictions.Fear:return" [ Fear ]";case n.Afflictions.FoodPoisoning:return" [ Food Poisoning ] ";case n.Afflictions.Infection:return" [ Infection ] ";case n.Afflictions.Pain:return" [ Pain ] ";case n.Afflictions.Wounds:return" [ Wounds ] "}},r.prototype.increaseHungry=function(){this._hungry<=0?(this.looseHealth(10),this._isDead&&this._game.log.addTempLog(this._name+" starved to death at day "+this._game.currentDay,e.LogType.StatusChange)):this._hungry=this._hungry-5},r.prototype.increaseStaminaToMax=function(){this._stamina=100},r.prototype.decreaseStamina=function(t){if(t<=0)throw new Error("Stamina value must be greater than zero");this._stamina=this._stamina-t,this._stamina<=0&&(this._stamina=0,this.looseHealth(20),this._isDead?this._game.log.addTempLog(this._name+" died of exhaustion at day "+this._game.currentDay,e.LogType.StatusChange):this._game.log.addTempLog(this._name+" is dying of tiredness",e.LogType.Result))},r.prototype.decreaseHungry=function(t){if(t<0)throw new Error("Hungry to decrease value must be greater than zero");this._hungry<100&&(this._hungry=this._hungry+t),this._hungry>100&&(this._hungry=100)},r.prototype.getHungry=function(){return"ü•´"+this._hungry+"%"},r.prototype.getHealth=function(){return"‚ù§Ô∏è"+this._health+"%"},r.prototype.getStamina=function(){return"‚ö°"+this._stamina+"%"},r.prototype.getSickness=function(){return this._sick?"Sick":"Not sick"},r.prototype.getDateOfBirth=function(){return this._dateOfBirth},r.prototype.sicken=function(){this._sick=!0},r.prototype.looseHealth=function(t){if(t<0||t>100)throw new Error("Invalid value for healthToLoose");this._health>0&&(this._health-=t,this._health<=0&&(this._health=0,this._isDead=!0,"you"==this._kinship&&this._game.stateManager.goToState(i.GameStates.GAME_OVER)))},r.prototype.increaseHealth=function(t){this._health+=t,this._health>100&&(this._health=100)},r}();exports.Character=r;
},{"../Game":"LMN3","../managers/LogManager":"pbwm","../enums/GameStates":"M2Er","../enums/Afflictions":"jkJc"}],"vgbH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CharacterManager=void 0;var r=require("../Game"),e=require("../entities/Character"),t=function(){function t(){this.previousCharacters=[],this.characters=[],this._game=r.Game.getInstance(),this.createAllCharacters(),this.savePreviousCharacters()}return t.prototype.start=function(){for(var r=0;r<this._game.characters.length;r++)this._game.characters[r].imageURL=document.getElementById("rip-page-image-"+(r+1)).src},t.prototype.createAllCharacters=function(){this.characters.push(new e.Character("Ethan","you",100,100,100,"1985",!1)),this.characters.push(new e.Character("Olivia","wife",100,100,100,"1988",!1)),this.characters.push(new e.Character("Michael","son",100,100,100,"2003",!1)),this.characters.push(new e.Character("Sophia","daughter",100,100,100,"2005",!1))},t.prototype.savePreviousCharacters=function(){this.previousCharacters=[];for(var r=0,t=this.characters;r<t.length;r++){var a=t[r];this.previousCharacters.push(new e.Character(a.name,a.kinship,a.health,a.stamina,a.hungry,a.getDateOfBirth(),a.isDead))}},t.prototype.increaseHungryOfAllCharacters=function(){for(var r=0,e=this.getCharactersAlive();r<e.length;r++){e[r].increaseHungry()}},t.prototype.decreaseStaminaOfAllCharacters=function(r){for(var e=0,t=this.getCharactersAlive();e<t.length;e++){t[e].decreaseStamina(r)}},t.prototype.increaseStaminaOfAllCharacters=function(r){for(var e=0,t=this.getCharactersAlive();e<t.length;e++){t[e].increaseStaminaToMax()}},t.prototype.getNumberOfCharactersAlive=function(){return this._game.characters.filter(function(r){return!r.isDead}).length},t.prototype.getCharactersAlive=function(){return this._game.characters.filter(function(r){return!r.isDead})},t.prototype.getCharactersDead=function(){return this._game.characters.filter(function(r){return r.isDead})},t.prototype.getFirstCharacterDeadAndNotBuried=function(){return this._game.characters.find(function(r){return r.isDead&&!r.buried})},t.prototype.isInDanger=function(){for(var r=0,e=this.getCharactersAlive();r<e.length;r++){var t=e[r];if(t.health<=25||t.stamina<=25||t.hungry<=25)return!0}return!1},t.prototype.picksACharacterAtRandom=function(){var r=this.getCharactersAlive();return r[this._game.getRandomArbitrary(r.length-1)]},t.prototype.makeSomeoneInTheGroupSick=function(){var r=this.picksACharacterAtRandom();return r.sicken(),r},t.prototype.decreasesTheHealthOfSomeoneInTheGroup=function(){var r=this.picksACharacterAtRandom();return r.looseHealth(30),r},t.prototype.statusOfTheCharactersChange=function(){for(var r=0;r<this.previousCharacters.length;r++)if(!this.previousCharacters[r].isDead&&(this.previousCharacters[r].health!=this.characters[r].health||this.previousCharacters[r].stamina!=this.characters[r].stamina||this.previousCharacters[r].hungry!=this.characters[r].hungry))return this.previousCharacters=this.characters,!0;return!1},t}();exports.CharacterManager=t;
},{"../Game":"LMN3","../entities/Character":"X9QG"}],"XxXA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Clock=void 0;var e=function(){function e(e,r){this._currentHour=e,this._anteMeridiem=r}return Object.defineProperty(e.prototype,"currentHour",{get:function(){return this._currentHour},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anteMeridiem",{get:function(){return this._anteMeridiem},enumerable:!1,configurable:!0}),e.prototype.nextHour=function(){11==this._currentHour&&(this._anteMeridiem=!this._anteMeridiem),12==this._currentHour?this._currentHour=1:this._currentHour++},e.prototype.showTime=function(){return(this._currentHour<=9?"0":"")+this._currentHour.toString()+":00 "+(this._anteMeridiem?"a.m":"p.m")},e}();exports.Clock=e;
},{}],"CvJj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.__extends=e,exports.__rest=n,exports.__decorate=o,exports.__param=a,exports.__metadata=i,exports.__awaiter=u,exports.__generator=c,exports.__createBinding=f,exports.__exportStar=l,exports.__values=s,exports.__read=p,exports.__spread=y,exports.__spreadArrays=_,exports.__await=h,exports.__asyncGenerator=v,exports.__asyncDelegator=d,exports.__asyncValues=b,exports.__makeTemplateObject=w,exports.__importStar=x,exports.__importDefault=m,exports.__classPrivateFieldGet=O,exports.__classPrivateFieldSet=g,exports.__assign=void 0;var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};function e(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return exports.__assign=r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},r.apply(this,arguments)};function n(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}function o(t,e,r,n){var o,a=arguments.length,i=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(i=(a<3?o(i):a>3?o(e,r,i):o(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i}function a(t,e){return function(r,n){e(r,n,t)}}function i(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function u(t,e,r,n){return new(r||(r=Promise))(function(o,a){function i(t){try{c(n.next(t))}catch(e){a(e)}}function u(t){try{c(n.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(i,u)}c((n=n.apply(t,e||[])).next())})}function c(t,e){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(u){a=[6,u],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function f(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}function l(t,e){for(var r in t)"default"===r||e.hasOwnProperty(r)||(e[r]=t[r])}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function p(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,a=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(u){o={error:u}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function y(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(p(arguments[e]));return t}function _(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<r;e++)for(var a=arguments[e],i=0,u=a.length;i<u;i++,o++)n[o]=a[i];return n}function h(t){return this instanceof h?(this.v=t,this):new h(t)}function v(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(t,e||[]),a=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(t){o[t]&&(n[t]=function(e){return new Promise(function(r,n){a.push([t,e,r,n])>1||u(t,e)})})}function u(t,e){try{(r=o[t](e)).value instanceof h?Promise.resolve(r.value.v).then(c,f):l(a[0][2],r)}catch(n){l(a[0][3],n)}var r}function c(t){u("next",t)}function f(t){u("throw",t)}function l(t,e){t(e),a.shift(),a.length&&u(a[0][0],a[0][1])}}function d(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,o){e[n]=t[n]?function(e){return(r=!r)?{value:h(t[n](e)),done:"return"===n}:o?o(e):e}:o}}function b(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof s?s(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,o){(function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)})(n,o,(e=t[r](e)).done,e.value)})}}}function w(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function x(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function m(t){return t&&t.__esModule?t:{default:t}}function O(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function g(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}exports.__assign=r;
},{}],"rrEo":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),r={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},o=function(t,e){if(!t)throw n(e)},n=function(t){return new Error("Firebase Database ("+r.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},i=function(t){for(var e=[],r=0,o=0;o<t.length;o++){var n=t.charCodeAt(o);n<128?e[r++]=n:n<2048?(e[r++]=n>>6|192,e[r++]=63&n|128):55296==(64512&n)&&o+1<t.length&&56320==(64512&t.charCodeAt(o+1))?(n=65536+((1023&n)<<10)+(1023&t.charCodeAt(++o)),e[r++]=n>>18|240,e[r++]=n>>12&63|128,e[r++]=n>>6&63|128,e[r++]=63&n|128):(e[r++]=n>>12|224,e[r++]=n>>6&63|128,e[r++]=63&n|128)}return e},s=function(t){for(var e=[],r=0,o=0;r<t.length;){var n=t[r++];if(n<128)e[o++]=String.fromCharCode(n);else if(n>191&&n<224){var i=t[r++];e[o++]=String.fromCharCode((31&n)<<6|63&i)}else if(n>239&&n<365){var s=((7&n)<<18|(63&(i=t[r++]))<<12|(63&(a=t[r++]))<<6|63&t[r++])-65536;e[o++]=String.fromCharCode(55296+(s>>10)),e[o++]=String.fromCharCode(56320+(1023&s))}else{i=t[r++];var a=t[r++];e[o++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a)}}return e.join("")},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[],n=0;n<t.length;n+=3){var i=t[n],s=n+1<t.length,a=s?t[n+1]:0,c=n+2<t.length,h=c?t[n+2]:0,u=i>>2,f=(3&i)<<4|a>>4,p=(15&a)<<2|h>>6,l=63&h;c||(l=64,s||(p=64)),o.push(r[u],r[f],r[p],r[l])}return o.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(i(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):s(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var r=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[],n=0;n<t.length;){var i=r[t.charAt(n++)],s=n<t.length?r[t.charAt(n)]:0,a=++n<t.length?r[t.charAt(n)]:64,c=++n<t.length?r[t.charAt(n)]:64;if(++n,null==i||null==s||null==a||null==c)throw Error();var h=i<<2|s>>4;if(o.push(h),64!==a){var u=s<<4&240|a>>2;if(o.push(u),64!==c){var f=a<<6&192|c;o.push(f)}}}return o},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},c=function(t){var e=i(t);return a.encodeByteArray(e,!0)},h=function(t){try{return a.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(t){return f(void 0,t)}function f(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var r in e)e.hasOwnProperty(r)&&(t[r]=f(t[r],e[r]));return t}var p=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,r){t.resolve=e,t.reject=r})}return t.prototype.wrapCallback=function(t){var e=this;return function(r,o){r?e.reject(r):e.resolve(o),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(r):t(r,o))}},t}();function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())}function v(){try{return"[object process]"===Object.prototype.toString.call(t.process)}catch(e){return!1}}function b(){return"object"==typeof self&&self.self===self}function y(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function _(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function E(){return l().indexOf("Electron/")>=0}function g(){var t=l();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function x(){return l().indexOf("MSAppHost/")>=0}function S(){return!0===r.NODE_CLIENT||!0===r.NODE_ADMIN}function A(){return!v()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function m(){return"indexedDB"in self&&null!=indexedDB}function O(){return new Promise(function(t,e){try{var r=!0,o="validate-browser-context-for-indexeddb-analytics-module",n=window.indexedDB.open(o);n.onsuccess=function(){n.result.close(),r||window.indexedDB.deleteDatabase(o),t(!0)},n.onupgradeneeded=function(){r=!1},n.onerror=function(){var t;e((null===(t=n.error)||void 0===t?void 0:t.message)||"")}}catch(i){e(i)}})}function C(){return!(!navigator||!navigator.cookieEnabled)}var w="FirebaseError",D=function(t){function r(e,o){var n=t.call(this,o)||this;return n.code=e,n.name=w,Object.setPrototypeOf(n,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,N.prototype.create),n}return e.__extends(r,t),r}(Error),N=function(){function t(t,e,r){this.service=t,this.serviceName=e,this.errors=r}return t.prototype.create=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];for(var o=e[0]||{},n=this.service+"/"+t,i=this.errors[t],s=i?T(i,o):"Error",a=this.serviceName+": "+s+" ("+n+").",c=new D(n,a),h=0,u=Object.keys(o);h<u.length;h++){var f=u[h];"_"!==f.slice(-1)&&(f in c&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),c[f]=o[f])}return c},t}();function T(t,e){return t.replace(M,function(t,r){var o=e[r];return null!=o?String(o):"<"+r+"?>"})}var M=/\{\$([^}]+)}/g;function B(t){return JSON.parse(t)}function j(t){return JSON.stringify(t)}var k=function(t){var e={},r={},o={},n="";try{var i=t.split(".");e=B(h(i[0])||""),r=B(h(i[1])||""),n=i[2],o=r.d||{},delete r.d}catch(s){}return{header:e,claims:r,data:o,signature:n}},P=function(t){var e=k(t).claims,r=Math.floor((new Date).getTime()/1e3),o=0,n=0;return"object"==typeof e&&(e.hasOwnProperty("nbf")?o=e.nbf:e.hasOwnProperty("iat")&&(o=e.iat),n=e.hasOwnProperty("exp")?e.exp:o+86400),!!r&&!!o&&!!n&&r>=o&&r<=n},I=function(t){var e=k(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null},V=function(t){var e=k(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},L=function(t){var e=k(t).claims;return"object"==typeof e&&!0===e.admin};function R(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function W(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function z(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function F(t,e,r){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(o[n]=e.call(r,t[n],n,t));return o}function U(t){for(var e=[],r=function(t,r){Array.isArray(r)?r.forEach(function(r){e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))},o=0,n=Object.entries(t);o<n.length;o++){var i=n[o];r(i[0],i[1])}return e.length?"&"+e.join("&"):""}function H(t){var e={};return t.replace(/^\?/,"").split("&").forEach(function(t){if(t){var r=t.split("=");e[r[0]]=r[1]}}),e}var q=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var r=this.W_;if("string"==typeof t)for(var o=0;o<16;o++)r[o]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(o=0;o<16;o++)r[o]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(o=16;o<80;o++){var n=r[o-3]^r[o-8]^r[o-14]^r[o-16];r[o]=4294967295&(n<<1|n>>>31)}var i,s,a=this.chain_[0],c=this.chain_[1],h=this.chain_[2],u=this.chain_[3],f=this.chain_[4];for(o=0;o<80;o++){o<40?o<20?(i=u^c&(h^u),s=1518500249):(i=c^h^u,s=1859775393):o<60?(i=c&h|u&(c|h),s=2400959708):(i=c^h^u,s=3395469782);n=(a<<5|a>>>27)+i+f+s+r[o]&4294967295;f=u,u=h,h=4294967295&(c<<30|c>>>2),c=a,a=n}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+h&4294967295,this.chain_[3]=this.chain_[3]+u&4294967295,this.chain_[4]=this.chain_[4]+f&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var r=e-this.blockSize,o=0,n=this.buf_,i=this.inbuf_;o<e;){if(0===i)for(;o<=r;)this.compress_(t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(n[i]=t.charCodeAt(o),++o,++i===this.blockSize){this.compress_(n),i=0;break}}else for(;o<e;)if(n[i]=t[o],++o,++i===this.blockSize){this.compress_(n),i=0;break}}this.inbuf_=i,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var r=this.blockSize-1;r>=56;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);var o=0;for(r=0;r<5;r++)for(var n=24;n>=0;n-=8)t[o]=this.chain_[r]>>n&255,++o;return t},t}();function J(t,e){var r=new G(t,e);return r.subscribe.bind(r)}var G=function(){function t(t,e){var r=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(r)}).catch(function(t){r.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,r){var o,n=this;if(void 0===t&&void 0===e&&void 0===r)throw new Error("Missing Observer.");void 0===(o=X(t,["next","error","complete"])?t:{next:t,error:e,complete:r}).next&&(o.next=$),void 0===o.error&&(o.error=$),void 0===o.complete&&(o.complete=$);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{n.finalError?o.error(n.finalError):o.complete()}catch(t){}}),this.observers.push(o),i},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var r=this;this.task.then(function(){if(void 0!==r.observers&&void 0!==r.observers[t])try{e(r.observers[t])}catch(o){"undefined"!=typeof console&&console.error&&console.error(o)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function K(t,e){return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];Promise.resolve(!0).then(function(){t.apply(void 0,r)}).catch(function(t){e&&e(t)})}}function X(t,e){if("object"!=typeof t||null===t)return!1;for(var r=0,o=e;r<o.length;r++){var n=o[r];if(n in t&&"function"==typeof t[n])return!0}return!1}function $(){}var Q=function(t,e,r,o){var n;if(o<e?n="at least "+e:o>r&&(n=0===r?"none":"no more than "+r),n)throw new Error(t+" failed: Was called with "+o+(1===o?" argument.":" arguments.")+" Expects "+n+".")};function Y(t,e,r){var o="";switch(e){case 1:o=r?"first":"First";break;case 2:o=r?"second":"Second";break;case 3:o=r?"third":"Third";break;case 4:o=r?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var n=t+" failed: ";return n+=o+" argument "}function Z(t,e,r,o){if((!o||r)&&"string"!=typeof r)throw new Error(Y(t,e,o)+"must be a valid firebase namespace.")}function tt(t,e,r,o){if((!o||r)&&"function"!=typeof r)throw new Error(Y(t,e,o)+"must be a valid function.")}function et(t,e,r,o){if((!o||r)&&("object"!=typeof r||null===r))throw new Error(Y(t,e,o)+"must be a valid context object.")}var rt=function(t){for(var e=[],r=0,n=0;n<t.length;n++){var i=t.charCodeAt(n);if(i>=55296&&i<=56319){var s=i-55296;o(++n<t.length,"Surrogate pair missing trail surrogate."),i=65536+(s<<10)+(t.charCodeAt(n)-56320)}i<128?e[r++]=i:i<2048?(e[r++]=i>>6|192,e[r++]=63&i|128):i<65536?(e[r++]=i>>12|224,e[r++]=i>>6&63|128,e[r++]=63&i|128):(e[r++]=i>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=63&i|128)}return e},ot=function(t){for(var e=0,r=0;r<t.length;r++){var o=t.charCodeAt(r);o<128?e++:o<2048?e+=2:o>=55296&&o<=56319?(e+=4,r++):e+=3}return e},nt=1e3,it=2,st=144e5,at=.5;function ct(t,e,r){void 0===e&&(e=nt),void 0===r&&(r=it);var o=e*Math.pow(r,t),n=Math.round(at*o*(Math.random()-.5)*2);return Math.min(st,o+n)}exports.CONSTANTS=r,exports.Deferred=p,exports.ErrorFactory=N,exports.FirebaseError=D,exports.MAX_VALUE_MILLIS=st,exports.RANDOM_FACTOR=at,exports.Sha1=q,exports.areCookiesEnabled=C,exports.assert=o,exports.assertionError=n,exports.async=K,exports.base64=a,exports.base64Decode=h,exports.base64Encode=c,exports.calculateBackoffMillis=ct,exports.contains=R,exports.createSubscribe=J,exports.decode=k,exports.deepCopy=u,exports.deepExtend=f,exports.errorPrefix=Y,exports.getUA=l,exports.isAdmin=L,exports.isBrowser=b,exports.isBrowserExtension=y,exports.isElectron=E,exports.isEmpty=z,exports.isIE=g,exports.isIndexedDBAvailable=m,exports.isMobileCordova=d,exports.isNode=v,exports.isNodeSdk=S,exports.isReactNative=_,exports.isSafari=A,exports.isUWP=x,exports.isValidFormat=V,exports.isValidTimestamp=P,exports.issuedAtTime=I,exports.jsonEval=B,exports.map=F,exports.querystring=U,exports.querystringDecode=H,exports.safeGet=W,exports.stringLength=ot,exports.stringToByteArray=rt,exports.stringify=j,exports.validateArgCount=Q,exports.validateCallback=tt,exports.validateContextObject=et,exports.validateIndexedDBOpenable=O,exports.validateNamespace=Z;
},{"tslib":"CvJj"}],"YHdR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("tslib"),e=require("@firebase/util"),n=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),r="[DEFAULT]",i=function(){function n(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return n.prototype.get=function(t){void 0===t&&(t=r);var n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){var i=new e.Deferred;this.instancesDeferred.set(n,i);try{var o=this.getOrInitializeService(n);o&&i.resolve(o)}catch(s){}}return this.instancesDeferred.get(n).promise},n.prototype.getImmediate=function(e){var n=t.__assign({identifier:r,optional:!1},e),i=n.identifier,o=n.optional,s=this.normalizeInstanceIdentifier(i);try{var a=this.getOrInitializeService(s);if(!a){if(o)return null;throw Error("Service "+this.name+" is not available")}return a}catch(c){if(o)return null;throw c}},n.prototype.getComponent=function(){return this.component},n.prototype.setComponent=function(e){var n,i;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,s(e))try{this.getOrInitializeService(r)}catch(l){}try{for(var o=t.__values(this.instancesDeferred.entries()),a=o.next();!a.done;a=o.next()){var c=t.__read(a.value,2),p=c[0],h=c[1],u=this.normalizeInstanceIdentifier(p);try{var f=this.getOrInitializeService(u);h.resolve(f)}catch(l){}}}catch(d){n={error:d}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},n.prototype.clearInstance=function(t){void 0===t&&(t=r),this.instancesDeferred.delete(t),this.instances.delete(t)},n.prototype.delete=function(){return t.__awaiter(this,void 0,void 0,function(){var e;return t.__generator(this,function(n){switch(n.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(t.__spread(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}),e.filter(function(t){return"_delete"in t}).map(function(t){return t._delete()})))];case 1:return n.sent(),[2]}})})},n.prototype.isComponentSet=function(){return null!=this.component},n.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,o(t)),this.instances.set(t,e)),e||null},n.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:r:t},n}();function o(t){return t===r?void 0:t}function s(t){return"EAGER"===t.instantiationMode}var a=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new i(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();exports.Component=n,exports.ComponentContainer=a,exports.Provider=i;
},{"tslib":"CvJj","@firebase/util":"rrEo"}],"srlT":[function(require,module,exports) {
"use strict";function e(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),n=0;for(t=0;t<r;t++)for(var l=arguments[t],i=0,s=l.length;i<s;i++,n++)o[n]=l[i];return o}var t;Object.defineProperty(exports,"__esModule",{value:!0}),exports.setLogLevel=g,exports.setUserLogHandler=u,exports.Logger=exports.LogLevel=void 0;var r,o=[];exports.LogLevel=r,function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(exports.LogLevel=r={}));var n={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},l=r.INFO,i=((t={})[r.DEBUG]="log",t[r.VERBOSE]="log",t[r.INFO]="info",t[r.WARN]="warn",t[r.ERROR]="error",t),s=function(t,r){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];if(!(r<t.logLevel)){var l=(new Date).toISOString(),s=i[r];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+r+")");console[s].apply(console,e(["["+l+"]  "+t.name+":"],o))}},a=function(){function t(e){this.name=e,this._logLevel=l,this._logHandler=s,this._userLogHandler=null,o.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in r))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?n[e]:e},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.DEBUG],t)),this._logHandler.apply(this,e([this,r.DEBUG],t))},t.prototype.log=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.VERBOSE],t)),this._logHandler.apply(this,e([this,r.VERBOSE],t))},t.prototype.info=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.INFO],t)),this._logHandler.apply(this,e([this,r.INFO],t))},t.prototype.warn=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.WARN],t)),this._logHandler.apply(this,e([this,r.WARN],t))},t.prototype.error=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this._userLogHandler&&this._userLogHandler.apply(this,e([this,r.ERROR],t)),this._logHandler.apply(this,e([this,r.ERROR],t))},t}();function g(e){o.forEach(function(t){t.setLogLevel(e)})}function u(e,t){for(var l=function(o){var l=null;t&&t.level&&(l=n[t.level]),o.userLogHandler=null===e?null:function(t,o){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var s=n.map(function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}}).filter(function(e){return e}).join(" ");o>=(null!=l?l:t.logLevel)&&e({level:r[o].toLowerCase(),message:s,args:n,type:t.name})}},i=0,s=o;i<s.length;i++){l(s[i])}}exports.Logger=a;
},{}],"QzTI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,n,r=require("tslib"),t=require("@firebase/util"),i=require("@firebase/component"),a=require("@firebase/logger"),o=((e={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",e["bad-app-name"]="Illegal App name: '{$appName}",e["duplicate-app"]="Firebase App named '{$appName}' already exists",e["app-deleted"]="Firebase App named '{$appName}' already deleted",e["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",e["invalid-log-argument"]="First argument to `onLog` must be null or a function.",e),s=new t.ErrorFactory("app","Firebase",o),p="@firebase/app",l="0.6.11",c="@firebase/analytics",u="@firebase/auth",f="@firebase/database",d="@firebase/functions",m="@firebase/installations",b="@firebase/messaging",h="@firebase/performance",g="@firebase/remote-config",v="@firebase/storage",y="@firebase/firestore",_="firebase-wrapper",w="[DEFAULT]",N=((n={})[p]="fire-core",n[c]="fire-analytics",n[u]="fire-auth",n[f]="fire-rtdb",n[d]="fire-fn",n[m]="fire-iid",n[b]="fire-fcm",n[h]="fire-perf",n[g]="fire-rc",n[v]="fire-gcs",n[y]="fire-fst",n["fire-js"]="fire-js",n[_]="fire-js-all",n),C=new a.Logger("@firebase/app"),I=function(){function e(e,n,a){var o,s,p=this;this.firebase_=a,this.isDeleted_=!1,this.name_=n.name,this.automaticDataCollectionEnabled_=n.automaticDataCollectionEnabled||!1,this.options_=t.deepCopy(e),this.container=new i.ComponentContainer(n.name),this._addComponent(new i.Component("app",function(){return p},"PUBLIC"));try{for(var l=r.__values(this.firebase_.INTERNAL.components.values()),c=l.next();!c.done;c=l.next()){var u=c.value;this._addComponent(u)}}catch(f){o={error:f}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(o)throw o.error}}}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise(function(n){e.checkDestroyed_(),n()}).then(function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map(function(e){return e.delete()}))}).then(function(){e.isDeleted_=!0})},e.prototype._getService=function(e,n){return void 0===n&&(n=w),this.checkDestroyed_(),this.container.getProvider(e).getImmediate({identifier:n})},e.prototype._removeServiceInstance=function(e,n){void 0===n&&(n=w),this.container.getProvider(e).clearInstance(n)},e.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(n){C.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,n)}},e.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw s.create("app-deleted",{appName:this.name_})},e}();I.prototype.name&&I.prototype.options||I.prototype.delete||console.log("dc");var E="7.20.0";function A(e){var n={},o=new Map,p={__esModule:!0,initializeApp:function(r,i){void 0===i&&(i={});if("object"!=typeof i||null===i){var a=i;i={name:a}}var o=i;void 0===o.name&&(o.name=w);var l=o.name;if("string"!=typeof l||!l)throw s.create("bad-app-name",{appName:String(l)});if(t.contains(n,l))throw s.create("duplicate-app",{appName:l});var c=new e(r,o,p);return n[l]=c,c},app:l,registerVersion:function(e,n,r){var t,a=null!==(t=N[e])&&void 0!==t?t:e;r&&(a+="-"+r);var o=a.match(/\s|\//),s=n.match(/\s|\//);if(o||s){var p=['Unable to register library "'+a+'" with version "'+n+'":'];return o&&p.push('library name "'+a+'" contains illegal characters (whitespace or "/")'),o&&s&&p.push("and"),s&&p.push('version name "'+n+'" contains illegal characters (whitespace or "/")'),void C.warn(p.join(" "))}c(new i.Component(a+"-version",function(){return{library:a,version:n}},"VERSION"))},setLogLevel:a.setLogLevel,onLog:function(e,n){if(null!==e&&"function"!=typeof e)throw s.create("invalid-log-argument",{appName:name});a.setUserLogHandler(e,n)},apps:null,SDK_VERSION:E,INTERNAL:{registerComponent:c,removeApp:function(e){delete n[e]},components:o,useAsService:function(e,n){if("serverAuth"===n)return null;return n}}};function l(e){if(e=e||w,!t.contains(n,e))throw s.create("no-app",{appName:e});return n[e]}function c(i){var a,c,u=i.name;if(o.has(u))return C.debug("There were multiple attempts to register component "+u+"."),"PUBLIC"===i.type?p[u]:null;if(o.set(u,i),"PUBLIC"===i.type){var f=function(e){if(void 0===e&&(e=l()),"function"!=typeof e[u])throw s.create("invalid-app-argument",{appName:u});return e[u]()};void 0!==i.serviceProps&&t.deepExtend(f,i.serviceProps),p[u]=f,e.prototype[u]=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._getService.bind(this,u).apply(this,i.multipleInstances?e:[])}}try{for(var d=r.__values(Object.keys(n)),m=d.next();!m.done;m=d.next()){var b=m.value;n[b]._addComponent(i)}}catch(h){a={error:h}}finally{try{m&&!m.done&&(c=d.return)&&c.call(d)}finally{if(a)throw a.error}}return"PUBLIC"===i.type?p[u]:null}return p.default=p,Object.defineProperty(p,"apps",{get:function(){return Object.keys(n).map(function(e){return n[e]})}}),l.App=e,p}function F(){var e=A(I);return e.INTERNAL=r.__assign(r.__assign({},e.INTERNAL),{createFirebaseNamespace:F,extendNamespace:function(n){t.deepExtend(e,n)},createSubscribe:t.createSubscribe,ErrorFactory:t.ErrorFactory,deepExtend:t.deepExtend}),e}var P=F(),L=function(){function e(e){this.container=e}return e.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(e){if(D(e)){var n=e.getImmediate();return n.library+"/"+n.version}return null}).filter(function(e){return e}).join(" ")},e}();function D(e){var n=e.getComponent();return"VERSION"===(null==n?void 0:n.type)}function j(e,n){e.INTERNAL.registerComponent(new i.Component("platform-logger",function(e){return new L(e)},"PRIVATE")),e.registerVersion(p,l,n),e.registerVersion("fire-js","")}if(t.isBrowser()&&void 0!==self.firebase){C.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var O=self.firebase.SDK_VERSION;O&&O.indexOf("LITE")>=0&&C.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var k=P.initializeApp;P.initializeApp=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.isNode()&&C.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),k.apply(void 0,e)};var x=P;j(x),exports.default=x,exports.firebase=x;
},{"tslib":"CvJj","@firebase/util":"rrEo","@firebase/component":"YHdR","@firebase/logger":"srlT"}],"YEwQ":[function(require,module,exports) {
"use strict";var e=require("@firebase/app");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=r(e),a="firebase",u="7.21.1";t.default.registerVersion(a,u,"app"),module.exports=t.default;
},{"@firebase/app":"QzTI"}],"fBPN":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ItemSeeds=exports.ItemsNames=void 0;var e,t=require("../entities/Item"),o=require("../enums/Afflictions");!function(e){e[e.FirstAid=0]="FirstAid",e[e.Food=1]="Food"}(e=exports.ItemsNames||(exports.ItemsNames={}));var n=function(){function e(){}return e.getItens=function(e,t){return this.items[e].amount=t,this.items[e]},e.getOneRandomItem=function(){return e.items[e.getRandomArbitrary(0,e.items.length)]},e.getRandomArbitrary=function(e,t){return Math.floor(Math.random()*(t-e)+e)},e.items=[new t.Item("Bandages",t.ItemType.FirstAid,10,[o.Afflictions.BloodLoss,o.Afflictions.BrokenRibs]),new t.Item("Herbal Meds",t.ItemType.FirstAid,5,[o.Afflictions.Anxiety]),new t.Item("Antibiotics",t.ItemType.FirstAid,15,[o.Afflictions.Infection,o.Afflictions.FoodPoisoning,o.Afflictions.Dysentery]),new t.Item("Antiseptic",t.ItemType.FirstAid,15,[o.Afflictions.Wounds]),new t.Item("Painkillers",t.ItemType.FirstAid,15,[o.Afflictions.Pain,o.Afflictions.BrokenRibs]),new t.Item("Raw Food",t.ItemType.Food,10),new t.Item("Vegetables",t.ItemType.Food,5),new t.Item("Canned Food",t.ItemType.Food,10),new t.Item("Cigarette",t.ItemType.Food,15),new t.Item("Beef jerky",t.ItemType.Food,15),new t.Item("Bear meat",t.ItemType.Food,15),new t.Item("Chocolate Bar",t.ItemType.Food,20),new t.Item("Condensed milk",t.ItemType.Food,15),new t.Item("Cup of coffee",t.ItemType.Food,10),new t.Item("Cup of herbal tea",t.ItemType.Food,10),new t.Item("Dog food",t.ItemType.Food,15),new t.Item("Energy bar",t.ItemType.Food,25),new t.Item("Water (unsafe)",t.ItemType.Food,10),new t.Item("Granola bar",t.ItemType.Food,15),new t.Item("Orange soda",t.ItemType.Food,20)],e}();exports.ItemSeeds=n;
},{"../entities/Item":"SNDR","../enums/Afflictions":"jkJc"}],"zegf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ItemPickerManager=void 0;var t=require("../Game"),e=require("../seeds/ItemSeeds"),i=require("../enums/GameStates"),n=require("../managers/LogManager"),s=function(){function s(){var e=this;this._itemsToPick=[],this._myItems=[],this._myItemsMax=2,this.itemsFound=4,this._game=t.Game.getInstance(),this._continueBtn=document.querySelector("#item-picker-page-continue-btn"),this._continueBtn.addEventListener("click",function(){e.onContinueBtn()}),this._itemsToPickListElement=document.querySelector("#item-picker-page-items-to-pick"),this._myItemsListElement=document.querySelector("#item-picker-page-item-my-items"),this._yourItemsTitle=document.querySelector("#your-items-title"),this._takeAllBtn=document.querySelector("#item-picker-page-take-all-btn")}return s.prototype.start=function(){this._itemsToPick=[],this._myItems=[],this.character=this._game.characterManager.picksACharacterAtRandom();for(var t=0;t<this.itemsFound;t++){var i=e.ItemSeeds.getOneRandomItem();this.addItemToPick(i)}this.showItems()},s.prototype.showItems=function(){this._itemsToPick.length<=this._myItemsMax-this._myItems.length?this._takeAllBtn.disabled=!1:this._takeAllBtn.disabled=!0,this.showItemsToPick(),this.showMyItems()},s.prototype.showItemsToPick=function(){var t=this;this._itemsToPickListElement.innerHTML="";for(var e=function(e){var n=document.createElement("li"),s=document.createElement("button");s.appendChild(document.createTextNode(e.name+" ("+e.effect+") "+e.showAmount())),s.addEventListener("click",function(){return t.selectItemToPick(e)}),i._myItems.length>=i._myItemsMax&&(s.disabled=!0),n.appendChild(s),i._itemsToPickListElement.appendChild(n)},i=this,n=0,s=this._itemsToPick;n<s.length;n++){e(s[n])}},s.prototype.showMyItems=function(){var t=this;this._yourItemsTitle.innerHTML="Your items - ("+this._myItems.length+"/"+this._myItemsMax+")",this._myItemsListElement.innerHTML="";for(var e=function(e){var n=document.createElement("li"),s=document.createElement("button");s.appendChild(document.createTextNode(e.name+" ("+e.effect+") "+e.showAmount())),s.addEventListener("click",function(){return t.selectItemMyItem(e)}),n.appendChild(s),i._myItemsListElement.appendChild(n)},i=this,n=0,s=this._myItems;n<s.length;n++){e(s[n])}},s.prototype.selectItemToPick=function(t){this.removeItemToPick(t.name),this.addMyItem(t),this.showItems()},s.prototype.selectItemMyItem=function(t){this.removeMyItem(t.name),this.addItemToPick(t),this.showItems()},s.prototype.removeItemToPick=function(t){this._itemsToPick=this._itemsToPick.filter(function(e){return e.name!==t})},s.prototype.removeMyItem=function(t){this._myItems=this._myItems.filter(function(e){return e.name!==t})},s.prototype.addItemToPick=function(t){var e=this._itemsToPick.findIndex(function(e){return e.name==t.name});e>=0?this._itemsToPick[e].increaseAmount():this._itemsToPick.push(t)},s.prototype.addMyItem=function(t){var e=this._myItems.findIndex(function(e){return e.name==t.name});e>=0?this._myItems[e].increaseAmount():this._myItems.push(t)},s.prototype.onContinueBtn=function(){for(var t=0;t<this._myItems.length;t++)this._game.bagManager.putItem(this._myItems[t]),this._game.log.addTempLog(this.character.name+" picked up "+this._myItems[t].name,n.LogType.Result);this._game.stateManager.goToState(i.GameStates.LOG)},s}();exports.ItemPickerManager=s;
},{"../Game":"LMN3","../seeds/ItemSeeds":"fBPN","../enums/GameStates":"M2Er","../managers/LogManager":"pbwm"}],"g5IB":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"ekyg":[function(require,module,exports) {
var process = require("process");
var e=require("process");Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@firebase/app"),n=require("tslib"),r=require("@firebase/util"),i=require("@firebase/logger"),o=require("@firebase/component");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=s(t),h=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),r.stringify(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:r.jsonEval(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),u=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return r.contains(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),l=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new h(t)}}catch(n){}return new u},c=l("localStorage"),p=l("sessionStorage"),d=new i.Logger("@firebase/database"),f=function(){var e=1;return function(){return e++}}(),_=function(e){var t=r.stringToByteArray(e),n=new r.Sha1;n.update(t);var i=n.digest();return r.base64.encodeByteArray(i)},y=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",i=0;i<e.length;i++){var o=e[i];Array.isArray(o)||o&&"object"==typeof o&&"number"==typeof o.length?n+=y.apply(null,o):n+="object"==typeof o?r.stringify(o):o,n+=" "}return n},v=null,g=!0,m=function(e,t){r.assert(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(d.logLevel=i.LogLevel.VERBOSE,v=d.log.bind(d),t&&p.set("logging_enabled",!0)):"function"==typeof e?v=e:(v=null,p.remove("logging_enabled"))},C=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===g&&(g=!1,null===v&&!0===p.get("logging_enabled")&&m(!0)),v){var n=y.apply(null,e);v(n)}},E=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];C.apply(void 0,n.__spread([e],t))}},w=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="FIREBASE INTERNAL ERROR: "+y.apply(void 0,n.__spread(e));d.error(r)},T=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="FIREBASE FATAL ERROR: "+y.apply(void 0,n.__spread(e));throw d.error(r),new Error(r)},b=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="FIREBASE WARNING: "+y.apply(void 0,n.__spread(e));d.warn(r)},S=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&b("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},I=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},N=function(e){if(r.isNodeSdk()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},P="[MIN_NAME]",R="[MAX_NAME]",x=function(e,t){if(e===t)return 0;if(e===P||t===R)return-1;if(t===P||e===R)return 1;var n=U(e),r=U(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},D=function(e,t){return e===t?0:e<t?-1:1},k=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+r.stringify(t))},O=function(e){if("object"!=typeof e||null===e)return r.stringify(e);var t=[];for(var n in e)t.push(n);t.sort();for(var i="{",o=0;o<t.length;o++)0!==o&&(i+=","),i+=r.stringify(t[o]),i+=":",i+=O(e[t[o]]);return i+="}"},F=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function A(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var L=function(e){r.assert(!I(e),"Invalid JSON number");var t,n,i,o,s;0===e?(n=0,i=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(o=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(n=0,i=Math.round(e/Math.pow(2,-1074))));var a=[];for(s=52;s;s-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();var h=a.join(""),u="";for(s=0;s<64;s+=8){var l=parseInt(h.substr(s,8),2).toString(16);1===l.length&&(l="0"+l),u+=l}return u.toLowerCase()},M=function(){return!("object"!=typeof window||!window.chrome||!window.chrome.extension||/^chrome/.test(window.location.href))},W=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI},q=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+n);return r.code=e.toUpperCase(),r},Q=new RegExp("^-?(0*)\\d{1,10}$"),U=function(e){if(Q.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},V=function(e){try{e()}catch(t){setTimeout(function(){var e=t.stack||"";throw b("Exception was thrown by user callback.",e),t},Math.floor(0))}},H=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},j=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},B=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return Object.defineProperty(e,"Empty",{get:function(){return new e("")},enumerable:!1,configurable:!0}),e.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},e.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},e.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new e(this.pieces_,t)},e.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e.prototype.toUrlEncodedString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"},e.prototype.slice=function(e){return void 0===e&&(e=0),this.pieces_.slice(this.pieceNum_+e)},e.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)t.push(this.pieces_[n]);return new e(t,0)},e.prototype.child=function(t){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(t instanceof e)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new e(n,0)},e.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},e.relativePath=function(t,n){var r=t.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return e.relativePath(t.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+t+")")},e.comparePaths=function(e,t){for(var n=e.slice(),r=t.slice(),i=0;i<n.length&&i<r.length;i++){var o=x(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},e.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,n=e.pieceNum_;t<=this.pieces_.length;t++,n++)if(this.pieces_[t]!==e.pieces_[n])return!1;return!0},e.prototype.contains=function(e){var t=this.pieceNum_,n=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0},e}(),K=function(){function e(e,t){this.errorPrefix_=t,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=r.stringLength(this.parts_[n]);this.checkValid_()}return Object.defineProperty(e,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(e,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=r.stringLength(e),this.checkValid_()},e.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=r.stringLength(e),this.parts_.length>0&&(this.byteLength_-=1)},e.prototype.checkValid_=function(){if(this.byteLength_>e.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+e.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>e.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+e.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},e.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},e}(),Y="5",z="v",G="s",X="r",$="f",J="firebaseio.com",Z="ls",ee="p",te="websocket",ne="long_polling",re=function(){function e(e,t,n,r,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===s&&(s=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=c.get("host:"+e)||this.host}return e.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},e.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&c.set("host:"+this.host,this.internalHost))},e.prototype.connectionURL=function(e,t){var n;if(r.assert("string"==typeof e,"typeof type must == string"),r.assert("object"==typeof t,"typeof params must == object"),e===te)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==ne)throw new Error("Unknown connection type: "+e);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var i=[];return A(t,function(e,t){i.push(e+"="+t)}),n+i.join("&")},e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},e}();function ie(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(o){}t+="/"+i}return t}function oe(e){var t,r,i={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var o=n.__values(e.split("&")),s=o.next();!s.done;s=o.next()){var a=s.value;if(0!==a.length){var h=a.split("=");2===h.length?i[decodeURIComponent(h[0])]=decodeURIComponent(h[1]):b("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i}var se,ae,he=function(e,t){var n=ue(e),r=n.namespace;"firebase.com"===n.domain&&T(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||T("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||S();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new re(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new B(n.pathString)}},ue=function(e){var t="",n="",r="",i="",o="",s=!0,a="https",h=443;if("string"==typeof e){var u=e.indexOf("//");u>=0&&(a=e.substring(0,u-1),e=e.substring(u+2));var l=e.indexOf("/");-1===l&&(l=e.length);var c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(l,c)),l<c&&(i=ie(e.substring(l,c)));var p=oe(e.substring(Math.min(e.length,c)));(u=t.indexOf(":"))>=0?(s="https"===a||"wss"===a,h=parseInt(t.substring(u+1),10)):u=t.length;var d=t.slice(0,u);if("localhost"===d.toLowerCase())n="localhost";else if(d.split(".").length<=2)n=d;else{var f=t.indexOf(".");r=t.substring(0,f).toLowerCase(),n=t.substring(f+1),o=r}"ns"in p&&(o=p.ns)}return{host:t,port:h,domain:n,subdomain:r,secure:s,scheme:a,pathString:i,namespace:o}},le=/[\[\].#$\/\u0000-\u001F\u007F]/,ce=/[\[\].#$\u0000-\u001F\u007F]/,pe=10485760,de=function(e){return"string"==typeof e&&0!==e.length&&!le.test(e)},fe=function(e){return"string"==typeof e&&0!==e.length&&!ce.test(e)},_e=function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),fe(e)},ye=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!I(e)||e&&"object"==typeof e&&r.contains(e,".sv")},ve=function(e,t,n,i,o){o&&void 0===n||ge(r.errorPrefix(e,t,o),n,i)},ge=function(e,t,n){var i=n instanceof B?new K(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+i.toErrorString());if("function"==typeof t)throw new Error(e+"contains a function "+i.toErrorString()+" with contents = "+t.toString());if(I(t))throw new Error(e+"contains "+t.toString()+" "+i.toErrorString());if("string"==typeof t&&t.length>pe/3&&r.stringLength(t)>pe)throw new Error(e+"contains a string greater than "+pe+" utf8 bytes "+i.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var o=!1,s=!1;if(A(t,function(t,n){if(".value"===t)o=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!de(t)))throw new Error(e+" contains an invalid key ("+t+") "+i.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.push(t),ge(e,n,i),i.pop()}),o&&s)throw new Error(e+' contains ".value" child '+i.toErrorString()+" in addition to actual children.")}},me=function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=(r=t[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!de(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(B.comparePaths);var s=null;for(n=0;n<t.length;n++){if(r=t[n],null!==s&&s.contains(r))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}},Ce=function(e,t,n,i,o){if(!o||void 0!==n){var s=r.errorPrefix(e,t,o);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(s+" must be an object containing the children to replace.");var a=[];A(n,function(e,t){var n=new B(e);if(ge(s,t,i.child(n)),".priority"===n.getBack()&&!ye(t))throw new Error(s+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),me(s,a)}},Ee=function(e,t,n,i){if(!i||void 0!==n){if(I(n))throw new Error(r.errorPrefix(e,t,i)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!ye(n))throw new Error(r.errorPrefix(e,t,i)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},we=function(e,t,n,i){if(!i||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(r.errorPrefix(e,t,i)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Te=function(e,t,n,i){if(!(i&&void 0===n||de(n)))throw new Error(r.errorPrefix(e,t,i)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},be=function(e,t,n,i){if(!(i&&void 0===n||fe(n)))throw new Error(r.errorPrefix(e,t,i)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Se=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),be(e,t,n,r)},Ie=function(e,t){if(".info"===t.getFront())throw new Error(e+" failed = Can't modify data under /.info/")},Ne=function(e,t,n){var i=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!de(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==i.length&&!_e(i))throw new Error(r.errorPrefix(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},Pe=function(e,t,n,i){if((!i||void 0!==n)&&"boolean"!=typeof n)throw new Error(r.errorPrefix(e,t,i)+"must be a boolean.")},Re=function(){function e(e,t){this.repo_=e,this.path_=t}return e.prototype.cancel=function(e){r.validateArgCount("OnDisconnect.cancel",0,1,arguments.length),r.validateCallback("OnDisconnect.cancel",1,e,!0);var t=new r.Deferred;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},e.prototype.remove=function(e){r.validateArgCount("OnDisconnect.remove",0,1,arguments.length),Ie("OnDisconnect.remove",this.path_),r.validateCallback("OnDisconnect.remove",1,e,!0);var t=new r.Deferred;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},e.prototype.set=function(e,t){r.validateArgCount("OnDisconnect.set",1,2,arguments.length),Ie("OnDisconnect.set",this.path_),ve("OnDisconnect.set",1,e,this.path_,!1),r.validateCallback("OnDisconnect.set",2,t,!0);var n=new r.Deferred;return this.repo_.onDisconnectSet(this.path_,e,n.wrapCallback(t)),n.promise},e.prototype.setWithPriority=function(e,t,n){r.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length),Ie("OnDisconnect.setWithPriority",this.path_),ve("OnDisconnect.setWithPriority",1,e,this.path_,!1),Ee("OnDisconnect.setWithPriority",2,t,!1),r.validateCallback("OnDisconnect.setWithPriority",3,n,!0);var i=new r.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,i.wrapCallback(n)),i.promise},e.prototype.update=function(e,t){if(r.validateArgCount("OnDisconnect.update",1,2,arguments.length),Ie("OnDisconnect.update",this.path_),Array.isArray(e)){for(var n={},i=0;i<e.length;++i)n[""+i]=e[i];e=n,b("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ce("OnDisconnect.update",1,e,this.path_,!1),r.validateCallback("OnDisconnect.update",2,t,!0);var o=new r.Deferred;return this.repo_.onDisconnectUpdate(this.path_,e,o.wrapCallback(t)),o.promise},e}(),xe=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return r.validateArgCount("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),De=function(){var e="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",t=0,n=[];return function(i){var o,s=i===t;t=i;var a=new Array(8);for(o=7;o>=0;o--)a[o]=e.charAt(i%64),i=Math.floor(i/64);r.assert(0===i,"Cannot push at time == 0");var h=a.join("");if(s){for(o=11;o>=0&&63===n[o];o--)n[o]=0;n[o]++}else for(o=0;o<12;o++)n[o]=Math.floor(64*Math.random());for(o=0;o<12;o++)h+=e.charAt(n[o]);return r.assert(20===h.length,"nextPushId: Length should be 20."),h}}(),ke=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),Oe=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new ke(P,e),r=new ke(P,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return ke.MIN},e}(),Fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return se},set:function(e){se=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return x(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw r.assertionError("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return ke.MIN},t.prototype.maxPost=function(){return new ke(R,se)},t.prototype.makePost=function(e,t){return r.assert("string"==typeof e,"KeyIndex indexValue must always be a string."),new ke(e,se)},t.prototype.toString=function(){return".key"},t}(Oe),Ae=new Fe;function Le(e){ae=e}var Me,We,qe,Qe=function(e){return"number"==typeof e?"number:"+L(e):"string:"+e},Ue=function(e){if(e.isLeafNode()){var t=e.val();r.assert("string"==typeof t||"number"==typeof t||"object"==typeof t&&r.contains(t,".sv"),"Priority must be a string or number.")}else r.assert(e===ae||e.isEmpty(),"priority of unexpected type.");r.assert(e===ae||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Ve=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,r.assert(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ue(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return Me},set:function(e){Me=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var i=t.getFront();return null===i?n:n.isEmpty()&&".priority"!==i?this:(r.assert(".priority"!==i||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(i,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+Qe(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?L(this.value_):this.value_,this.lazyHash_=_(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(r.assert(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,i=typeof this.value_,o=e.VALUE_TYPE_ORDER.indexOf(n),s=e.VALUE_TYPE_ORDER.indexOf(i);return r.assert(o>=0,"Unknown leaf type: "+n),r.assert(s>=0,"Unknown leaf type: "+i),o===s?"object"===i?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-o},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();function He(e){We=e}function je(e){qe=e}var Be,Ke,Ye=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?x(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return ke.MIN},t.prototype.maxPost=function(){return new ke(R,new Ve("[PRIORITY-POST]",qe))},t.prototype.makePost=function(e,t){var n=We(e);return new ke(t,new Ve("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(Oe),ze=new Ye,Ge=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),Xe=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:Je.EMPTY_NODE,this.right=null!=o?o:Je.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return Je.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Je.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),$e=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new Xe(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),Je=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Xe.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Xe.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new Ge(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new Ge(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new Ge(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new Ge(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new $e,e}(),Ze=Math.log(2),et=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ze,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),tt=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,s,a=r-t;if(0===a)return null;if(1===a)return o=e[t],s=n?n(o):o,new Xe(s,o.node,Xe.BLACK,null,null);var h=parseInt(a/2,10)+t,u=i(t,h),l=i(h+1,r);return o=e[h],s=n?n(o):o,new Xe(s,o.node,Xe.BLACK,u,l)},o=function(t){for(var r=null,o=null,s=e.length,a=function(t,r){var o=s-t,a=s;s-=t;var u=i(o+1,a),l=e[o],c=n?n(l):l;h(new Xe(c,l.node,r,null,u))},h=function(e){r?(r.left=e,r=e):(o=e,r=e)},u=0;u<t.count;++u){var l=t.nextBitIsOne(),c=Math.pow(2,t.count-(u+1));l?a(c,Xe.BLACK):(a(c,Xe.BLACK),a(c,Xe.RED))}return o}(new et(e.length));return new Je(r||t,o)},nt={},rt=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return r.assert(nt&&ze,"ChildrenNode.ts has not been loaded"),Be=Be||new e({".priority":nt},{".priority":ze})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=r.safeGet(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Je?t:null},e.prototype.hasIndex=function(e){return r.contains(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,i){r.assert(t!==Ae,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var o,s=[],a=!1,h=i.getIterator(ke.Wrap),u=h.getNext();u;)a=a||t.isDefinedOn(u.node),s.push(u),u=h.getNext();o=a?tt(s,t.getCompare()):nt;var l=t.toString(),c=n.__assign({},this.indexSet_);c[l]=t;var p=n.__assign({},this.indexes_);return p[l]=o,new e(p,c)},e.prototype.addToIndexes=function(t,n){var i=this;return new e(r.map(this.indexes_,function(e,o){var s=r.safeGet(i.indexSet_,o);if(r.assert(s,"Missing index implementation for "+o),e===nt){if(s.isDefinedOn(t.node)){for(var a=[],h=n.getIterator(ke.Wrap),u=h.getNext();u;)u.name!==t.name&&a.push(u),u=h.getNext();return a.push(t),tt(a,s.getCompare())}return nt}var l=n.get(t.name),c=e;return l&&(c=c.remove(new ke(t.name,l))),c.insert(t,t.node)}),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(r.map(this.indexes_,function(e){if(e===nt)return e;var r=n.get(t.name);return r?e.remove(new ke(t.name,r)):e}),this.indexSet_)},e}();function it(e,t){return x(e.name,t.name)}function ot(e,t){return x(e,t)}var st=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ue(this.priorityNode_),this.children_.isEmpty()&&r.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return Ke||(Ke=new e(new Je(ot),null,rt.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||Ke},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Ke:t},e.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(r.assert(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var i=new ke(t,n),o=void 0,s=void 0;n.isEmpty()?(o=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(i,this.children_));var a=o.isEmpty()?Ke:this.priorityNode_;return new e(o,a,s)},e.prototype.updateChild=function(e,t){var n=e.getFront();if(null===n)return t;r.assert(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var i=this.getImmediateChild(n).updateChild(e.popFront(),t);return this.updateImmediateChild(n,i)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(ze,function(s,a){n[s]=a.val(t),r++,o&&e.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1}),!t&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+Qe(this.getPriority().val())+":"),this.forEachChild(ze,function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":_(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new ke(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new ke(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new ke(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,ke.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,ke.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ht?-1:0},e.prototype.withIndex=function(t){if(t===Ae||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===Ae||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(ze),r=t.getIterator(ze),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===Ae?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),at=function(e){function t(){return e.call(this,new Je(ot),st.EMPTY_NODE,rt.Default)||this}return n.__extends(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return st.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(st),ht=new at;Object.defineProperties(ke,{MIN:{value:new ke(P,st.EMPTY_NODE)},MAX:{value:new ke(R,ht)}}),Fe.__EMPTY_NODE=st.EMPTY_NODE,Ve.__childrenNodeConstructor=st,Le(ht),je(ht);var ut=!0;function lt(e,t){if(void 0===t&&(t=null),null===e)return st.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),r.assert(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Ve(e,lt(t));if(e instanceof Array||!ut){var n=st.EMPTY_NODE;return A(e,function(t,i){if(r.contains(e,t)&&"."!==t.substring(0,1)){var o=lt(i);!o.isLeafNode()&&o.isEmpty()||(n=n.updateImmediateChild(t,o))}}),n.updatePriority(lt(t))}var i=[],o=!1;if(A(e,function(e,t){if("."!==e.substring(0,1)){var n=lt(t);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),i.push(new ke(e,n)))}}),0===i.length)return st.EMPTY_NODE;var s=tt(i,it,function(e){return e.name},ot);if(o){var a=tt(i,ze.getCompare());return new st(s,lt(t),new rt({".priority":a},{".priority":ze}))}return new st(s,lt(t),rt.Default)}He(lt);var ct,pt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?x(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return ke.MIN},t.prototype.maxPost=function(){return ke.MAX},t.prototype.makePost=function(e,t){var n=lt(e);return new ke(t,n)},t.prototype.toString=function(){return".value"},t}(Oe),dt=new pt,ft=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,r.assert(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return n.__extends(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?x(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=lt(e),r=st.EMPTY_NODE.updateChild(this.indexPath_,n);return new ke(t,r)},t.prototype.maxPost=function(){var e=st.EMPTY_NODE.updateChild(this.indexPath_,ht);return new ke(R,e)},t.prototype.toString=function(){return this.indexPath_.slice().join("/")},t}(Oe),_t=function(){function e(e,t,n){this.node_=e,this.ref_=t,this.index_=n}return e.prototype.val=function(){return r.validateArgCount("DataSnapshot.val",0,0,arguments.length),this.node_.val()},e.prototype.exportVal=function(){return r.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},e.prototype.toJSON=function(){return r.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},e.prototype.exists=function(){return r.validateArgCount("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},e.prototype.child=function(t){r.validateArgCount("DataSnapshot.child",0,1,arguments.length),t=String(t),be("DataSnapshot.child",1,t,!1);var n=new B(t),i=this.ref_.child(n);return new e(this.node_.getChild(n),i,ze)},e.prototype.hasChild=function(e){r.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length),be("DataSnapshot.hasChild",1,e,!1);var t=new B(e);return!this.node_.getChild(t).isEmpty()},e.prototype.getPriority=function(){return r.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},e.prototype.forEach=function(t){var n=this;return r.validateArgCount("DataSnapshot.forEach",1,1,arguments.length),r.validateCallback("DataSnapshot.forEach",1,t,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(r,i){return t(new e(i,n.ref_.child(r),ze))})},e.prototype.hasChildren=function(){return r.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return r.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},e.prototype.getRef=function(){return r.validateArgCount("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),yt=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+r.stringify(this.snapshot.exportVal())},e}(),vt=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),gt=function(){function e(e,t,n){this.callback_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t.getQueryParams().getIndex();return new yt("value",this,new _t(e.snapshotNode,t.getRef(),n))},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){r.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var i=this.callback_;return function(){i.call(t,e.snapshot)}},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new vt(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),mt=function(){function e(e,t,n){this.callbacks_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,r.contains(this.callbacks_,t)},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new vt(this,e,t):null},e.prototype.createEvent=function(e,t){r.assert(null!=e.childName,"Child events should have a childName.");var n=t.getRef().child(e.childName),i=t.getQueryParams().getIndex();return new yt(e.type,this,new _t(e.snapshotNode,n,i),e.prevName)},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){r.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var i=this.callbacks_[e.eventType];return function(){i.call(t,e.snapshot,e.prevName)}},e.prototype.matches=function(t){var n=this;if(t instanceof e){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var r=Object.keys(t.callbacks_),i=Object.keys(this.callbacks_),o=r.length;if(o===i.length){if(1===o){var s=r[0],a=i[0];return!(a!==s||t.callbacks_[s]&&this.callbacks_[a]&&t.callbacks_[s]!==this.callbacks_[a])}return i.every(function(e){return t.callbacks_[e]===n.callbacks_[e]})}}}return!1},e.prototype.hasAnyCallback=function(){return null!==this.callbacks_},e}(),Ct=function(){function e(e,t,n,r){this.repo=e,this.path=t,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return r.assert(ct,"Reference.ts has not been loaded"),ct},set:function(e){ct=e},enumerable:!1,configurable:!0}),e.validateQueryEndpoints_=function(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Ae){var i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==P)throw new Error(i);if("string"!=typeof t)throw new Error(o)}if(e.hasEnd()){if(e.getIndexEndName()!==R)throw new Error(i);if("string"!=typeof n)throw new Error(o)}}else if(e.getIndex()===ze){if(null!=t&&!ye(t)||null!=n&&!ye(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(r.assert(e.getIndex()instanceof ft||e.getIndex()===dt,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},e.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},e.prototype.getQueryParams=function(){return this.queryParams_},e.prototype.getRef=function(){return r.validateArgCount("Query.ref",0,0,arguments.length),new e.__referenceConstructor(this.repo,this.path)},e.prototype.on=function(t,n,i,o){r.validateArgCount("Query.on",2,4,arguments.length),we("Query.on",1,t,!1),r.validateCallback("Query.on",2,n,!1);var s=e.getCancelAndContextArgs_("Query.on",i,o);if("value"===t)this.onValueEvent(n,s.cancel,s.context);else{var a={};a[t]=n,this.onChildEvent(a,s.cancel,s.context)}return n},e.prototype.onValueEvent=function(e,t,n){var r=new gt(e,t||null,n||null);this.repo.addEventCallbackForQuery(this,r)},e.prototype.onChildEvent=function(e,t,n){var r=new mt(e,t,n);this.repo.addEventCallbackForQuery(this,r)},e.prototype.off=function(e,t,n){r.validateArgCount("Query.off",0,3,arguments.length),we("Query.off",1,e,!0),r.validateCallback("Query.off",2,t,!0),r.validateContextObject("Query.off",3,n,!0);var i=null,o=null;"value"===e?i=new gt(t||null,null,n||null):e&&(t&&((o={})[e]=t),i=new mt(o,null,n||null));this.repo.removeEventCallbackForQuery(this,i)},e.prototype.once=function(t,n,i,o){var s=this;r.validateArgCount("Query.once",1,4,arguments.length),we("Query.once",1,t,!1),r.validateCallback("Query.once",2,n,!0);var a=e.getCancelAndContextArgs_("Query.once",i,o),h=!0,u=new r.Deferred;u.promise.catch(function(){});var l=function(e){h&&(h=!1,s.off(t,l),n&&n.bind(a.context)(e),u.resolve(e))};return this.on(t,l,function(e){s.off(t,l),a.cancel&&a.cancel.bind(a.context)(e),u.reject(e)}),u.promise},e.prototype.limitToFirst=function(t){if(r.validateArgCount("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},e.prototype.limitToLast=function(t){if(r.validateArgCount("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},e.prototype.orderByChild=function(t){if(r.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');be("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new B(t);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var i=new ft(n),o=this.queryParams_.orderBy(i);return e.validateQueryEndpoints_(o),new e(this.repo,this.path,o,!0)},e.prototype.orderByKey=function(){r.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(Ae);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByPriority=function(){r.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(ze);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByValue=function(){r.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(dt);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.startAt=function(t,n){void 0===t&&(t=null),r.validateArgCount("Query.startAt",0,2,arguments.length),ve("Query.startAt",1,t,this.path,!0),Te("Query.startAt",2,n,!0);var i=this.queryParams_.startAt(t,n);if(e.validateLimit_(i),e.validateQueryEndpoints_(i),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(t=null,n=null),new e(this.repo,this.path,i,this.orderByCalled_)},e.prototype.endAt=function(t,n){void 0===t&&(t=null),r.validateArgCount("Query.endAt",0,2,arguments.length),ve("Query.endAt",1,t,this.path,!0),Te("Query.endAt",2,n,!0);var i=this.queryParams_.endAt(t,n);if(e.validateLimit_(i),e.validateQueryEndpoints_(i),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new e(this.repo,this.path,i,this.orderByCalled_)},e.prototype.equalTo=function(e,t){if(r.validateArgCount("Query.equalTo",1,2,arguments.length),ve("Query.equalTo",1,e,this.path,!1),Te("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},e.prototype.toString=function(){return r.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},e.prototype.toJSON=function(){return r.validateArgCount("Query.toJSON",0,1,arguments.length),this.toString()},e.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},e.prototype.queryIdentifier=function(){var e=this.queryObject(),t=O(e);return"{}"===t?"default":t},e.prototype.isEqual=function(t){if(r.validateArgCount("Query.isEqual",1,1,arguments.length),!(t instanceof e)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}var n=this.repo===t.repo,i=this.path.equals(t.path),o=this.queryIdentifier()===t.queryIdentifier();return n&&i&&o},e.getCancelAndContextArgs_=function(e,t,n){var i={cancel:null,context:null};if(t&&n)i.cancel=t,r.validateCallback(e,3,i.cancel,!0),i.context=n,r.validateContextObject(e,4,i.context,!0);else if(t)if("object"==typeof t&&null!==t)i.context=t;else{if("function"!=typeof t)throw new Error(r.errorPrefix(e,3,!0)+" must either be a cancel callback or a context object.");i.cancel=t}return i},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Et=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),wt=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=this.path_.child(t);return new e(this.syncTree_,n)},e.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},e}(),Tt=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},bt=function(e,t,n){return e&&"object"==typeof e?(r.assert(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?St(e[".sv"],t,n):"object"==typeof e[".sv"]?It(e[".sv"],t):void r.assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},St=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:r.assert(!1,"Unexpected server value: "+e)}},It=function(e,t,n){e.hasOwnProperty("increment")||r.assert(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var i=e.increment;"number"!=typeof i&&r.assert(!1,"Unexpected increment value: "+i);var o=t.node();if(r.assert(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return i;var s=o.getValue();return"number"!=typeof s?i:s+i},Nt=function(e,t,n,r){return Rt(t,new wt(n,e),r)},Pt=function(e,t,n){return Rt(e,new Et(t),n)};function Rt(e,t,n){var r,i=e.getPriority().val(),o=bt(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var s=e,a=bt(s.getValue(),t,n);return a!==s.getValue()||o!==s.getPriority().val()?new Ve(a,lt(o)):e}var h=e;return r=h,o!==h.getPriority().val()&&(r=r.updatePriority(new Ve(o))),h.forEachChild(ze,function(e,i){var o=Rt(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))}),r}var xt,Dt=function(){function e(){this.value=null,this.children=new Map}return e.prototype.find=function(e){if(null!=this.value)return this.value.getChild(e);if(!e.isEmpty()&&this.children.size>0){var t=e.getFront();return e=e.popFront(),this.children.has(t)?this.children.get(t).find(e):null}return null},e.prototype.remember=function(t,n){if(t.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,n);else{var r=t.getFront();this.children.has(r)||this.children.set(r,new e);var i=this.children.get(r);t=t.popFront(),i.remember(t,n)}},e.prototype.forget=function(e){if(e.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var t=this.value;this.value=null;var n=this;return t.forEachChild(ze,function(e,t){n.remember(new B(e),t)}),this.forget(e)}if(this.children.size>0){var r=e.getFront();if(e=e.popFront(),this.children.has(r))this.children.get(r).forget(e)&&this.children.delete(r);return 0===this.children.size}return!0},e.prototype.forEachTree=function(e,t){null!==this.value?t(e,this.value):this.forEachChild(function(n,r){var i=new B(e.toString()+"/"+n);r.forEachTree(i,t)})},e.prototype.forEachChild=function(e){this.children.forEach(function(t,n){e(n,t)})},e}();!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(xt||(xt={}));var kt,Ot,Ft=function(){function e(e,t,n,i){this.fromUser=e,this.fromServer=t,this.queryId=n,this.tagged=i,r.assert(!i||t,"Tagged queries must be from server.")}return e.User=new e(!0,!1,null,!1),e.Server=new e(!1,!0,null,!1),e.forServerTaggedQuery=function(t){return new e(!1,!0,t,!0)},e}(),At=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=xt.ACK_USER_WRITE,this.source=Ft.User}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return r.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new B(t));return new e(B.Empty,n,this.revert)}return r.assert(this.path.getFront()===t,"operationForChild called for unrelated child."),new e(this.path.popFront(),this.affectedTree,this.revert)},e}(),Lt=function(){return kt||(kt=new Je(D)),kt},Mt=function(){function e(e,t){void 0===t&&(t=Lt()),this.value=e,this.children=t}return e.fromObject=function(t){var n=e.Empty;return A(t,function(e,t){n=n.set(new B(e),t)}),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:B.Empty,value:this.value};if(e.isEmpty())return null;var n=e.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(e.popFront(),t);return null!=i?{path:new B(n).child(i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},e.prototype.subtree=function(t){if(t.isEmpty())return this;var n=t.getFront(),r=this.children.get(n);return null!==r?r.subtree(t.popFront()):e.Empty},e.prototype.set=function(t,n){if(t.isEmpty())return new e(n,this.children);var r=t.getFront(),i=(this.children.get(r)||e.Empty).set(t.popFront(),n),o=this.children.insert(r,i);return new e(this.value,o)},e.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?e.Empty:new e(null,this.children);var n=t.getFront(),r=this.children.get(n);if(r){var i=r.remove(t.popFront()),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?e.Empty:new e(this.value,o)}return this},e.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront(),n=this.children.get(t);return n?n.get(e.popFront()):null},e.prototype.setTree=function(t,n){if(t.isEmpty())return n;var r=t.getFront(),i=(this.children.get(r)||e.Empty).setTree(t.popFront(),n),o=void 0;return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,o)},e.prototype.fold=function(e){return this.fold_(B.Empty,e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(e.child(r),t)}),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,B.Empty,t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(e.isEmpty())return null;var i=e.getFront(),o=this.children.get(i);return o?o.findOnPath_(e.popFront(),t.child(i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,B.Empty,t)},e.prototype.foreachOnPath_=function(t,n,r){if(t.isEmpty())return this;this.value&&r(n,this.value);var i=t.getFront(),o=this.children.get(i);return o?o.foreachOnPath_(t.popFront(),n.child(i),r):e.Empty},e.prototype.foreach=function(e){this.foreach_(B.Empty,e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal(function(n,r){r.foreach_(e.child(n),t)}),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal(function(t,n){n.value&&e(t,n.value)})},e.Empty=new e(null),e}(),Wt=function(){function e(e,t){this.source=e,this.path=t,this.type=xt.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,B.Empty):new e(this.source,this.path.popFront())},e}(),qt=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=xt.OVERWRITE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,B.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)},e}(),Qt=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=xt.MERGE}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){var n=this.children.subtree(new B(t));return n.isEmpty()?null:n.value?new qt(this.source,B.Empty,n.value):new e(this.source,B.Empty,n)}return r.assert(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,this.path.popFront(),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),Ut=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),Vt=function(){function e(e,t){this.eventCache_=e,this.serverCache_=t}return e.prototype.updateEventSnap=function(t,n,r){return new e(new Ut(t,n,r),this.serverCache_)},e.prototype.updateServerSnap=function(t,n,r){return new e(this.eventCache_,new Ut(t,n,r))},e.prototype.getEventCache=function(){return this.eventCache_},e.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},e.prototype.getServerCache=function(){return this.serverCache_},e.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},e.Empty=new e(new Ut(st.EMPTY_NODE,!1,!1),new Ut(st.EMPTY_NODE,!1,!1)),e}(),Ht=function(){function e(e,t,n,r,i){this.type=e,this.snapshotNode=t,this.childName=n,this.oldSnap=r,this.prevName=i}return e.valueChange=function(t){return new e(e.VALUE,t)},e.childAddedChange=function(t,n){return new e(e.CHILD_ADDED,n,t)},e.childRemovedChange=function(t,n){return new e(e.CHILD_REMOVED,n,t)},e.childChangedChange=function(t,n,r){return new e(e.CHILD_CHANGED,n,t,r)},e.childMovedChange=function(t,n){return new e(e.CHILD_MOVED,n,t)},e.CHILD_ADDED="child_added",e.CHILD_REMOVED="child_removed",e.CHILD_CHANGED="child_changed",e.CHILD_MOVED="child_moved",e.VALUE="value",e}(),jt=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,i,o,s){r.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(i).equals(n.getChild(i))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(Ht.childRemovedChange(t,a)):r.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(Ht.childAddedChange(t,n)):s.trackChildChange(Ht.childChangedChange(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(ze,function(e,r){t.hasChild(e)||n.trackChildChange(Ht.childRemovedChange(e,r))}),t.isLeafNode()||t.forEachChild(ze,function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(Ht.childChangedChange(t,r,i))}else n.trackChildChange(Ht.childAddedChange(t,r))})),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?st.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),Bt=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;r.assert(t===Ht.CHILD_ADDED||t===Ht.CHILD_CHANGED||t===Ht.CHILD_REMOVED,"Only child changes supported for tracking"),r.assert(".priority"!==n,"Only non-priority child changes can be tracked.");var i=this.changeMap.get(n);if(i){var o=i.type;if(t===Ht.CHILD_ADDED&&o===Ht.CHILD_REMOVED)this.changeMap.set(n,Ht.childChangedChange(n,e.snapshotNode,i.snapshotNode));else if(t===Ht.CHILD_REMOVED&&o===Ht.CHILD_ADDED)this.changeMap.delete(n);else if(t===Ht.CHILD_REMOVED&&o===Ht.CHILD_CHANGED)this.changeMap.set(n,Ht.childRemovedChange(n,i.oldSnap));else if(t===Ht.CHILD_CHANGED&&o===Ht.CHILD_ADDED)this.changeMap.set(n,Ht.childAddedChange(n,e.snapshotNode));else{if(t!==Ht.CHILD_CHANGED||o!==Ht.CHILD_CHANGED)throw r.assertionError("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,Ht.childChangedChange(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),Kt=function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}(),Yt=new Kt,zt=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new Ut(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,t,1,n,e);return 0===i.length?null:i[0]},e}(),Gt=function(){return function(e,t){this.viewCache=e,this.changes=t}}(),Xt=function(){function e(e){this.filter_=e}return e.prototype.assertIndexed=function(e){r.assert(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),r.assert(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},e.prototype.applyOperation=function(t,n,i,o){var s,a,h=new Bt;if(n.type===xt.OVERWRITE){var u=n;u.source.fromUser?s=this.applyUserOverwrite_(t,u.path,u.snap,i,o,h):(r.assert(u.source.fromServer,"Unknown source."),a=u.source.tagged||t.getServerCache().isFiltered()&&!u.path.isEmpty(),s=this.applyServerOverwrite_(t,u.path,u.snap,i,o,a,h))}else if(n.type===xt.MERGE){var l=n;l.source.fromUser?s=this.applyUserMerge_(t,l.path,l.children,i,o,h):(r.assert(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.getServerCache().isFiltered(),s=this.applyServerMerge_(t,l.path,l.children,i,o,a,h))}else if(n.type===xt.ACK_USER_WRITE){var c=n;s=c.revert?this.revertUserWrite_(t,c.path,i,o,h):this.ackUserWrite_(t,c.path,c.affectedTree,i,o,h)}else{if(n.type!==xt.LISTEN_COMPLETE)throw r.assertionError("Unknown operation type: "+n.type);s=this.listenComplete_(t,n.path,i,h)}var p=h.getChanges();return e.maybeAddValueEvent_(t,s,p),new Gt(s,p)},e.maybeAddValueEvent_=function(e,t,n){var r=t.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=e.getCompleteEventSnap();(n.length>0||!e.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Ht.valueChange(t.getCompleteEventSnap()))}},e.prototype.generateEventCacheAfterServerEvent_=function(e,t,n,i,o){var s=e.getEventCache();if(null!=n.shadowingWrite(t))return e;var a=void 0,h=void 0;if(t.isEmpty())if(r.assert(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var u=e.getCompleteServerSnap(),l=u instanceof st?u:st.EMPTY_NODE,c=n.calcCompleteEventChildren(l);a=this.filter_.updateFullNode(e.getEventCache().getNode(),c,o)}else{var p=n.calcCompleteEventCache(e.getCompleteServerSnap());a=this.filter_.updateFullNode(e.getEventCache().getNode(),p,o)}else{var d=t.getFront();if(".priority"===d){r.assert(1===t.getLength(),"Can't have a priority with additional path components");var f=s.getNode();h=e.getServerCache().getNode();var _=n.calcEventCacheAfterServerOverwrite(t,f,h);a=null!=_?this.filter_.updatePriority(f,_):s.getNode()}else{var y=t.popFront(),v=void 0;if(s.isCompleteForChild(d)){h=e.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(t,s.getNode(),h);v=null!=g?s.getNode().getImmediateChild(d).updateChild(y,g):s.getNode().getImmediateChild(d)}else v=n.calcCompleteChild(d,e.getServerCache());a=null!=v?this.filter_.updateChild(s.getNode(),d,v,y,i,o):s.getNode()}}return e.updateEventSnap(a,s.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},e.prototype.applyServerOverwrite_=function(e,t,n,r,i,o,s){var a,h=e.getServerCache(),u=o?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())a=u.updateFullNode(h.getNode(),n,null);else if(u.filtersNodes()&&!h.isFiltered()){var l=h.getNode().updateChild(t,n);a=u.updateFullNode(h.getNode(),l,null)}else{var c=t.getFront();if(!h.isCompleteForPath(t)&&t.getLength()>1)return e;var p=t.popFront(),d=h.getNode().getImmediateChild(c).updateChild(p,n);a=".priority"===c?u.updatePriority(h.getNode(),d):u.updateChild(h.getNode(),c,d,p,Yt,null)}var f=e.updateServerSnap(a,h.isFullyInitialized()||t.isEmpty(),u.filtersNodes()),_=new zt(r,f,i);return this.generateEventCacheAfterServerEvent_(f,t,r,_,s)},e.prototype.applyUserOverwrite_=function(e,t,n,r,i,o){var s,a,h=e.getEventCache(),u=new zt(r,e,i);if(t.isEmpty())a=this.filter_.updateFullNode(e.getEventCache().getNode(),n,o),s=e.updateEventSnap(a,!0,this.filter_.filtersNodes());else{var l=t.getFront();if(".priority"===l)a=this.filter_.updatePriority(e.getEventCache().getNode(),n),s=e.updateEventSnap(a,h.isFullyInitialized(),h.isFiltered());else{var c=t.popFront(),p=h.getNode().getImmediateChild(l),d=void 0;if(c.isEmpty())d=n;else{var f=u.getCompleteChild(l);d=null!=f?".priority"===c.getBack()&&f.getChild(c.parent()).isEmpty()?f:f.updateChild(c,n):st.EMPTY_NODE}if(p.equals(d))s=e;else{var _=this.filter_.updateChild(h.getNode(),l,d,c,u,o);s=e.updateEventSnap(_,h.isFullyInitialized(),this.filter_.filtersNodes())}}}return s},e.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},e.prototype.applyUserMerge_=function(t,n,r,i,o,s){var a=this,h=t;return r.foreach(function(r,u){var l=n.child(r);e.cacheHasChild_(t,l.getFront())&&(h=a.applyUserOverwrite_(h,l,u,i,o,s))}),r.foreach(function(r,u){var l=n.child(r);e.cacheHasChild_(t,l.getFront())||(h=a.applyUserOverwrite_(h,l,u,i,o,s))}),h},e.prototype.applyMerge_=function(e,t){return t.foreach(function(t,n){e=e.updateChild(t,n)}),e},e.prototype.applyServerMerge_=function(e,t,n,r,i,o,s){var a=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var h,u=e;h=t.isEmpty()?n:Mt.Empty.setTree(t,n);var l=e.getServerCache().getNode();return h.children.inorderTraversal(function(t,n){if(l.hasChild(t)){var h=e.getServerCache().getNode().getImmediateChild(t),c=a.applyMerge_(h,n);u=a.applyServerOverwrite_(u,new B(t),c,r,i,o,s)}}),h.children.inorderTraversal(function(t,n){var h=!e.getServerCache().isCompleteForChild(t)&&null==n.value;if(!l.hasChild(t)&&!h){var c=e.getServerCache().getNode().getImmediateChild(t),p=a.applyMerge_(c,n);u=a.applyServerOverwrite_(u,new B(t),p,r,i,o,s)}}),u},e.prototype.ackUserWrite_=function(e,t,n,r,i,o){if(null!=r.shadowingWrite(t))return e;var s=e.getServerCache().isFiltered(),a=e.getServerCache();if(null!=n.value){if(t.isEmpty()&&a.isFullyInitialized()||a.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,a.getNode().getChild(t),r,i,s,o);if(t.isEmpty()){var h=Mt.Empty;return a.getNode().forEachChild(Ae,function(e,t){h=h.set(new B(e),t)}),this.applyServerMerge_(e,t,h,r,i,s,o)}return e}var u=Mt.Empty;return n.foreach(function(e,n){var r=t.child(e);a.isCompleteForPath(r)&&(u=u.set(e,a.getNode().getChild(r)))}),this.applyServerMerge_(e,t,u,r,i,s,o)},e.prototype.listenComplete_=function(e,t,n,r){var i=e.getServerCache(),o=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,t,n,Yt,r)},e.prototype.revertUserWrite_=function(e,t,n,i,o){var s;if(null!=n.shadowingWrite(t))return e;var a=new zt(n,e,i),h=e.getEventCache().getNode(),u=void 0;if(t.isEmpty()||".priority"===t.getFront()){var l=void 0;if(e.getServerCache().isFullyInitialized())l=n.calcCompleteEventCache(e.getCompleteServerSnap());else{var c=e.getServerCache().getNode();r.assert(c instanceof st,"serverChildren would be complete if leaf node"),l=n.calcCompleteEventChildren(c)}l=l,u=this.filter_.updateFullNode(h,l,o)}else{var p=t.getFront(),d=n.calcCompleteChild(p,e.getServerCache());null==d&&e.getServerCache().isCompleteForChild(p)&&(d=h.getImmediateChild(p)),(u=null!=d?this.filter_.updateChild(h,p,d,t.popFront(),a,o):e.getEventCache().getNode().hasChild(p)?this.filter_.updateChild(h,p,st.EMPTY_NODE,t.popFront(),a,o):h).isEmpty()&&e.getServerCache().isFullyInitialized()&&(s=n.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,s,o))}return s=e.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(B.Empty),e.updateEventSnap(u,s,this.filter_.filtersNodes())},e}(),$t=function(){function e(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}return e.prototype.generateEventsForChanges=function(e,t,n){var r=this,i=[],o=[];return e.forEach(function(e){e.type===Ht.CHILD_CHANGED&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push(Ht.childMovedChange(e.childName,e.snapshotNode))}),this.generateEventsForType_(i,Ht.CHILD_REMOVED,e,n,t),this.generateEventsForType_(i,Ht.CHILD_ADDED,e,n,t),this.generateEventsForType_(i,Ht.CHILD_MOVED,o,n,t),this.generateEventsForType_(i,Ht.CHILD_CHANGED,e,n,t),this.generateEventsForType_(i,Ht.VALUE,e,n,t),i},e.prototype.generateEventsForType_=function(e,t,n,r,i){var o=this,s=n.filter(function(e){return e.type===t});s.sort(this.compareChanges_.bind(this)),s.forEach(function(t){var n=o.materializeSingleChange_(t,i);r.forEach(function(r){r.respondsTo(t.type)&&e.push(r.createEvent(n,o.query_))})})},e.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type?e:(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_),e)},e.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw r.assertionError("Should only compare child_ events.");var n=new ke(e.childName,e.snapshotNode),i=new ke(t.childName,t.snapshotNode);return this.index_.compare(n,i)},e}(),Jt=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new jt(n.getIndex()),i=n.getNodeFilter();this.processor_=new Xt(i);var o=t.getServerCache(),s=t.getEventCache(),a=r.updateFullNode(st.EMPTY_NODE,o.getNode(),null),h=i.updateFullNode(st.EMPTY_NODE,s.getNode(),null),u=new Ut(a,o.isFullyInitialized(),r.filtersNodes()),l=new Ut(h,s.isFullyInitialized(),i.filtersNodes());this.viewCache_=new Vt(l,u),this.eventGenerator_=new $t(this.query_)}return e.prototype.getQuery=function(){return this.query_},e.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},e.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},e.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},e.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},e.prototype.removeEventRegistration=function(e,t){var n=[];if(t){r.assert(null==e,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(e){t=t;var r=e.createCancelEvent(t,i);r&&n.push(r)})}if(e){for(var o=[],s=0;s<this.eventRegistrations_.length;++s){var a=this.eventRegistrations_[s];if(a.matches(e)){if(e.hasAnyCallback()){o=o.concat(this.eventRegistrations_.slice(s+1));break}}else o.push(a)}this.eventRegistrations_=o}else this.eventRegistrations_=[];return n},e.prototype.applyOperation=function(e,t,n){e.type===xt.MERGE&&null!==e.source.queryId&&(r.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),r.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var i=this.viewCache_,o=this.processor_.applyOperation(i,e,t,n);return this.processor_.assertIndexed(o.viewCache),r.assert(o.viewCache.getServerCache().isFullyInitialized()||!i.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=o.viewCache,this.generateEventsForChanges_(o.changes,o.viewCache.getEventCache().getNode(),null)},e.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(ze,function(e,t){n.push(Ht.childAddedChange(e,t))});return t.isFullyInitialized()&&n.push(Ht.valueChange(t.getNode())),this.generateEventsForChanges_(n,t.getNode(),e)},e.prototype.generateEventsForChanges_=function(e,t,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,r)},e}(),Zt=function(){function e(){this.views=new Map}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return r.assert(Ot,"Reference.ts has not been loaded"),Ot},set:function(e){r.assert(!Ot,"__referenceConstructor has already been defined"),Ot=e},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this.views.size},e.prototype.applyOperation=function(e,t,i){var o,s,a=e.source.queryId;if(null!==a){var h=this.views.get(a);return r.assert(null!=h,"SyncTree gave us an op for an invalid query."),h.applyOperation(e,t,i)}var u=[];try{for(var l=n.__values(this.views.values()),c=l.next();!c.done;c=l.next()){h=c.value;u=u.concat(h.applyOperation(e,t,i))}}catch(p){o={error:p}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(o)throw o.error}}return u},e.prototype.addEventRegistration=function(e,t,n,r,i){var o=e.queryIdentifier(),s=this.views.get(o);if(!s){var a=n.calcCompleteEventCache(i?r:null),h=!1;a?h=!0:r instanceof st?(a=n.calcCompleteEventChildren(r),h=!1):(a=st.EMPTY_NODE,h=!1);var u=new Vt(new Ut(a,h,!1),new Ut(r,i,!1));s=new Jt(e,u),this.views.set(o,s)}return s.addEventRegistration(t),s.getInitialEvents(t)},e.prototype.removeEventRegistration=function(t,r,i){var o,s,a=t.queryIdentifier(),h=[],u=[],l=this.hasCompleteView();if("default"===a)try{for(var c=n.__values(this.views.entries()),p=c.next();!p.done;p=c.next()){var d=n.__read(p.value,2),f=d[0],_=d[1];u=u.concat(_.removeEventRegistration(r,i)),_.isEmpty()&&(this.views.delete(f),_.getQuery().getQueryParams().loadsAllData()||h.push(_.getQuery()))}}catch(y){o={error:y}}finally{try{p&&!p.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}else(_=this.views.get(a))&&(u=u.concat(_.removeEventRegistration(r,i)),_.isEmpty()&&(this.views.delete(a),_.getQuery().getQueryParams().loadsAllData()||h.push(_.getQuery())));return l&&!this.hasCompleteView()&&h.push(new e.__referenceConstructor(t.repo,t.path)),{removed:h,events:u}},e.prototype.getQueryViews=function(){var e,t,r=[];try{for(var i=n.__values(this.views.values()),o=i.next();!o.done;o=i.next()){var s=o.value;s.getQuery().getQueryParams().loadsAllData()||r.push(s)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r},e.prototype.getCompleteServerCache=function(e){var t,r,i=null;try{for(var o=n.__values(this.views.values()),s=o.next();!s.done;s=o.next()){var a=s.value;i=i||a.getCompleteServerCache(e)}}catch(h){t={error:h}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i},e.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var t=e.queryIdentifier();return this.views.get(t)},e.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},e.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},e.prototype.getCompleteView=function(){var e,t;try{for(var r=n.__values(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.getQuery().getQueryParams().loadsAllData())return o}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return null},e}(),en=function(){function e(e){this.writeTree_=e}return e.prototype.addWrite=function(t,n){if(t.isEmpty())return new e(new Mt(n));var r=this.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,s=B.relativePath(i,t);return o=o.updateChild(s,n),new e(this.writeTree_.set(i,o))}var a=new Mt(n);return new e(this.writeTree_.setTree(t,a))},e.prototype.addWrites=function(e,t){var n=this;return A(t,function(t,r){n=n.addWrite(e.child(t),r)}),n},e.prototype.removeWrite=function(t){return t.isEmpty()?e.Empty:new e(this.writeTree_.setTree(t,Mt.Empty))},e.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},e.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(B.relativePath(t.path,e)):null},e.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(ze,function(t,n){e.push(new ke(t,n))}):this.writeTree_.children.inorderTraversal(function(t,n){null!=n.value&&e.push(new ke(t,n.value))}),e},e.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var n=this.getCompleteNode(t);return new e(null!=n?new Mt(n):this.writeTree_.subtree(t))},e.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},e.prototype.apply=function(e){return tn(B.Empty,this.writeTree_,e)},e.Empty=new e(new Mt(null)),e}();function tn(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var i=null;return t.children.inorderTraversal(function(t,o){".priority"===t?(r.assert(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):n=tn(e.child(t),o,n)}),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(e.child(".priority"),i)),n}var nn=function(){function e(){this.visibleWrites_=en.Empty,this.allWrites_=[],this.lastWriteId_=-1}return e.prototype.childWrites=function(e){return new rn(e,this)},e.prototype.addOverwrite=function(e,t,n,i){r.assert(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),this.allWrites_.push({path:e,snap:t,writeId:n,visible:i}),i&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=n},e.prototype.addMerge=function(e,t,n){r.assert(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=n},e.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var n=this.allWrites_[t];if(n.writeId===e)return n}return null},e.prototype.removeWrite=function(e){var t=this,n=this.allWrites_.findIndex(function(t){return t.writeId===e});r.assert(n>=0,"removeWrite called with nonexistent writeId.");var i=this.allWrites_[n];this.allWrites_.splice(n,1);for(var o=i.visible,s=!1,a=this.allWrites_.length-1;o&&a>=0;){var h=this.allWrites_[a];h.visible&&(a>=n&&this.recordContainsPath_(h,i.path)?o=!1:i.path.contains(h.path)&&(s=!0)),a--}if(o){if(s)return this.resetTree_(),!0;i.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(i.path):A(i.children,function(e){t.visibleWrites_=t.visibleWrites_.removeWrite(i.path.child(e))});return!0}return!1},e.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcCompleteEventCache=function(t,n,r,i){if(r||i){var o=this.visibleWrites_.childCompoundWrite(t);if(!i&&o.isEmpty())return n;if(i||null!=n||o.hasCompleteWrite(B.Empty)){var s=e.layerTree_(this.allWrites_,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))},t);u=n||st.EMPTY_NODE;return s.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(t);if(null!=a)return a;var h=this.visibleWrites_.childCompoundWrite(t);if(h.isEmpty())return n;if(null!=n||h.hasCompleteWrite(B.Empty)){var u=n||st.EMPTY_NODE;return h.apply(u)}return null},e.prototype.calcCompleteEventChildren=function(e,t){var n=st.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(e);if(r)return r.isLeafNode()||r.forEachChild(ze,function(e,t){n=n.updateImmediateChild(e,t)}),n;if(t){var i=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(ze,function(e,t){var r=i.childCompoundWrite(new B(e)).apply(t);n=n.updateImmediateChild(e,r)}),i.getCompleteChildren().forEach(function(e){n=n.updateImmediateChild(e.name,e.node)}),n}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach(function(e){n=n.updateImmediateChild(e.name,e.node)}),n},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n,i){r.assert(n||i,"Either existingEventSnap or existingServerSnap must exist");var o=e.child(t);if(this.visibleWrites_.hasCompleteWrite(o))return null;var s=this.visibleWrites_.childCompoundWrite(o);return s.isEmpty()?i.getChild(t):s.apply(i.getChild(t))},e.prototype.calcCompleteChild=function(e,t,n){var r=e.child(t),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(t)):null},e.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcIndexedSlice=function(e,t,n,r,i,o){var s,a=this.visibleWrites_.childCompoundWrite(e),h=a.getCompleteNode(B.Empty);if(null!=h)s=h;else{if(null==t)return[];s=a.apply(t)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var u=[],l=o.getCompare(),c=i?s.getReverseIteratorFrom(n,o):s.getIteratorFrom(n,o),p=c.getNext();p&&u.length<r;)0!==l(p,n)&&u.push(p),p=c.getNext();return u},e.prototype.recordContainsPath_=function(e,t){if(e.snap)return e.path.contains(t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&e.path.child(n).contains(t))return!0;return!1},e.prototype.resetTree_=function(){this.visibleWrites_=e.layerTree_(this.allWrites_,e.DefaultFilter_,B.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},e.DefaultFilter_=function(e){return e.visible},e.layerTree_=function(e,t,n){for(var i=en.Empty,o=0;o<e.length;++o){var s=e[o];if(t(s)){var a=s.path,h=void 0;if(s.snap)n.contains(a)?(h=B.relativePath(n,a),i=i.addWrite(h,s.snap)):a.contains(n)&&(h=B.relativePath(a,n),i=i.addWrite(B.Empty,s.snap.getChild(h)));else{if(!s.children)throw r.assertionError("WriteRecord should have .snap or .children");if(n.contains(a))h=B.relativePath(n,a),i=i.addWrites(h,s.children);else if(a.contains(n))if((h=B.relativePath(a,n)).isEmpty())i=i.addWrites(B.Empty,s.children);else{var u=r.safeGet(s.children,h.getFront());if(u){var l=u.getChild(h.popFront());i=i.addWrite(B.Empty,l)}}}}}return i},e}(),rn=function(){function e(e,t){this.treePath_=e,this.writeTree_=t}return e.prototype.calcCompleteEventCache=function(e,t,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,n)},e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,n)},e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},e.prototype.calcIndexedSlice=function(e,t,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,n,r,i)},e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}(),on=function(){function e(e){this.listenProvider_=e,this.syncPointTree_=Mt.Empty,this.pendingWriteTree_=new nn,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return e.prototype.applyUserOverwrite=function(e,t,n,r){return this.pendingWriteTree_.addOverwrite(e,t,n,r),r?this.applyOperationToSyncPoints_(new qt(Ft.User,e,t)):[]},e.prototype.applyUserMerge=function(e,t,n){this.pendingWriteTree_.addMerge(e,t,n);var r=Mt.fromObject(t);return this.applyOperationToSyncPoints_(new Qt(Ft.User,e,r))},e.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var n=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var r=Mt.Empty;return null!=n.snap?r=r.set(B.Empty,!0):A(n.children,function(e,t){r=r.set(new B(e),t)}),this.applyOperationToSyncPoints_(new At(n.path,r,t))}return[]},e.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new qt(Ft.Server,e,t))},e.prototype.applyServerMerge=function(e,t){var n=Mt.fromObject(t);return this.applyOperationToSyncPoints_(new Qt(Ft.Server,e,n))},e.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new Wt(Ft.Server,e))},e.prototype.applyTaggedQueryOverwrite=function(t,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var o=e.parseQueryKey_(i),s=o.path,a=o.queryId,h=B.relativePath(s,t),u=new qt(Ft.forServerTaggedQuery(a),h,n);return this.applyTaggedOperation_(s,u)}return[]},e.prototype.applyTaggedQueryMerge=function(t,n,r){var i=this.queryKeyForTag_(r);if(i){var o=e.parseQueryKey_(i),s=o.path,a=o.queryId,h=B.relativePath(s,t),u=Mt.fromObject(n),l=new Qt(Ft.forServerTaggedQuery(a),h,u);return this.applyTaggedOperation_(s,l)}return[]},e.prototype.applyTaggedListenComplete=function(t,n){var r=this.queryKeyForTag_(n);if(r){var i=e.parseQueryKey_(r),o=i.path,s=i.queryId,a=B.relativePath(o,t),h=new Wt(Ft.forServerTaggedQuery(s),a);return this.applyTaggedOperation_(o,h)}return[]},e.prototype.addEventRegistration=function(t,n){var i=t.path,o=null,s=!1;this.syncPointTree_.foreachOnPath(i,function(e,t){var n=B.relativePath(e,i);o=o||t.getCompleteServerCache(n),s=s||t.hasCompleteView()});var a,h=this.syncPointTree_.get(i);(h?(s=s||h.hasCompleteView(),o=o||h.getCompleteServerCache(B.Empty)):(h=new Zt,this.syncPointTree_=this.syncPointTree_.set(i,h)),null!=o)?a=!0:(a=!1,o=st.EMPTY_NODE,this.syncPointTree_.subtree(i).foreachChild(function(e,t){var n=t.getCompleteServerCache(B.Empty);n&&(o=o.updateImmediateChild(e,n))}));var u=h.viewExistsForQuery(t);if(!u&&!t.getQueryParams().loadsAllData()){var l=e.makeQueryKey_(t);r.assert(!this.queryToTagMap.has(l),"View does not exist, but we have a tag");var c=e.getNextQueryTag_();this.queryToTagMap.set(l,c),this.tagToQueryMap.set(c,l)}var p=this.pendingWriteTree_.childWrites(i),d=h.addEventRegistration(t,n,p,o,a);if(!u&&!s){var f=h.viewForQuery(t);d=d.concat(this.setupListener_(t,f))}return d},e.prototype.removeEventRegistration=function(t,n,r){var i=this,o=t.path,s=this.syncPointTree_.get(o),a=[];if(s&&("default"===t.queryIdentifier()||s.viewExistsForQuery(t))){var h=s.removeEventRegistration(t,n,r);s.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(o));var u=h.removed;a=h.events;var l=-1!==u.findIndex(function(e){return e.getQueryParams().loadsAllData()}),c=this.syncPointTree_.findOnPath(o,function(e,t){return t.hasCompleteView()});if(l&&!c){var p=this.syncPointTree_.subtree(o);if(!p.isEmpty())for(var d=this.collectDistinctViewsForSubTree_(p),f=0;f<d.length;++f){var _=d[f],y=_.getQuery(),v=this.createListenerForView_(_);this.listenProvider_.startListening(e.queryForListening_(y),this.tagForQuery_(y),v.hashFn,v.onComplete)}}if(!c&&u.length>0&&!r)if(l){this.listenProvider_.stopListening(e.queryForListening_(t),null)}else u.forEach(function(t){var n=i.queryToTagMap.get(e.makeQueryKey_(t));i.listenProvider_.stopListening(e.queryForListening_(t),n)});this.removeTags_(u)}return a},e.prototype.calcCompleteEventCache=function(e,t){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(e,function(t,n){var r=B.relativePath(t,e),i=n.getCompleteServerCache(r);if(i)return i});return n.calcCompleteEventCache(e,r,t,!0)},e.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold(function(e,t,n){if(t&&t.hasCompleteView())return[t.getCompleteView()];var r=[];return t&&(r=t.getQueryViews()),A(n,function(e,t){r=r.concat(t)}),r})},e.prototype.removeTags_=function(t){for(var n=0;n<t.length;++n){var r=t[n];if(!r.getQueryParams().loadsAllData()){var i=e.makeQueryKey_(r),o=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(o)}}},e.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},e.prototype.setupListener_=function(t,n){var i=t.path,o=this.tagForQuery_(t),s=this.createListenerForView_(n),a=this.listenProvider_.startListening(e.queryForListening_(t),o,s.hashFn,s.onComplete),h=this.syncPointTree_.subtree(i);if(o)r.assert(!h.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=h.fold(function(e,t,n){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(t.getQueryViews().map(function(e){return e.getQuery()}))),A(n,function(e,t){r=r.concat(t)}),r}),l=0;l<u.length;++l){var c=u[l];this.listenProvider_.stopListening(e.queryForListening_(c),this.tagForQuery_(c))}return a},e.prototype.createListenerForView_=function(e){var t=this,n=e.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(e.getServerCache()||st.EMPTY_NODE).hash()},onComplete:function(e){if("ok"===e)return r?t.applyTaggedListenComplete(n.path,r):t.applyListenComplete(n.path);var i=q(e,n);return t.removeEventRegistration(n,null,i)}}},e.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},e.parseQueryKey_=function(e){var t=e.indexOf("$");return r.assert(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new B(e.substr(0,t))}},e.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)},e.prototype.tagForQuery_=function(t){var n=e.makeQueryKey_(t);return this.queryToTagMap.get(n)},e.getNextQueryTag_=function(){return e.nextQueryTag_++},e.prototype.applyTaggedOperation_=function(e,t){var n=this.syncPointTree_.get(e);r.assert(n,"Missing sync point for query tag that we're tracking");var i=this.pendingWriteTree_.childWrites(e);return n.applyOperation(t,i,null)},e.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(B.Empty))},e.prototype.applyOperationHelper_=function(e,t,n,r){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,n,r);var i=t.get(B.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(B.Empty));var o=[],s=e.path.getFront(),a=e.operationForChild(s),h=t.children.get(s);if(h&&a){var u=n?n.getImmediateChild(s):null,l=r.child(s);o=o.concat(this.applyOperationHelper_(a,h,u,l))}return i&&(o=o.concat(i.applyOperation(e,r,n))),o},e.prototype.applyOperationDescendantsHelper_=function(e,t,n,r){var i=this,o=t.get(B.Empty);null==n&&null!=o&&(n=o.getCompleteServerCache(B.Empty));var s=[];return t.children.inorderTraversal(function(t,o){var a=n?n.getImmediateChild(t):null,h=r.child(t),u=e.operationForChild(t);u&&(s=s.concat(i.applyOperationDescendantsHelper_(u,o,a,h)))}),o&&(s=s.concat(o.applyOperation(e,r,n))),s},e.nextQueryTag_=1,e}(),sn=function(){function e(){this.rootNode_=st.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}(),an=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),r.contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return r.deepCopy(this.counters_)},e}(),hn=function(){function e(){}return e.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new an),this.collections_[t]},e.getOrCreateReporter=function(e,t){var n=e.toString();return this.reporters_[n]||(this.reporters_[n]=t()),this.reporters_[n]},e.collections_={},e.reporters_={},e}(),un=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=n.__assign({},e);return this.last_&&A(this.last_,function(e,n){t[e]=t[e]-n}),this.last_=e,t},e}(),ln=1e4,cn=3e4,pn=3e5,dn=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new un(e);var n=ln+(cn-ln)*Math.random();j(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.includeStat=function(e){this.statsToReport_[e]=!0},e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},i=!1;A(t,function(t,o){o>0&&r.contains(e.statsToReport_,t)&&(n[t]=o,i=!0)}),i&&this.server_.reportStats(n),j(this.reportStats_.bind(this),Math.floor(2*Math.random()*pn))},e}(),fn=function(){function e(){this.eventLists_=[],this.recursionDepth_=0}return e.prototype.queueEvents=function(e){for(var t=null,n=0;n<e.length;n++){var r=e[n],i=r.getPath();null===t||i.equals(t.getPath())||(this.eventLists_.push(t),t=null),null===t&&(t=new _n(i)),t.add(r)}t&&this.eventLists_.push(t)},e.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},e.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},e.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)e(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):t=!1}t&&(this.eventLists_=[]),this.recursionDepth_--},e}(),_n=function(){function e(e){this.path_=e,this.events_=[]}return e.prototype.add=function(e){this.events_.push(e)},e.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var n=t.getEventRunner();v&&C("event: "+t.toString()),V(n)}}},e.prototype.getPath=function(){return this.path_},e}(),yn=function(){function e(e){this.allowedEvents_=e,this.listeners_={},r.assert(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(Array.isArray(this.listeners_[e]))for(var i=n.__spread(this.listeners_[e]),o=0;o<i.length;o++)i[o].callback.apply(i[o].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){r.assert(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},e}(),vn=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))},!1),r}return n.__extends(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return r.assert("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(yn),gn=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||r.isMobileCordova()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return n.__extends(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return r.assert("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(yn),mn=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&V(function(){n.onMessage_(e[t])})},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),Cn="start",En="close",wn="pLPCommand",Tn="pRTLPCB",bn="id",Sn="pw",In="ser",Nn="cb",Pn="seg",Rn="ts",xn="d",Dn="dframe",kn=1870,On=30,Fn=kn-On,An=25e3,Ln=3e4,Mn=function(){function e(e,t,n,r,i){this.connId=e,this.repoInfo=t,this.applicationId=n,this.transportSessionId=r,this.lastSessionId=i,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=E(e),this.stats_=hn.getCollection(t),this.urlFn=function(e){return t.connectionURL(ne,e)}}return e.prototype.open=function(e,t){var r=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new mn(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){r.log_("Timed out trying to connect."),r.onClosed_(),r.connectTimeoutTimer_=null},Math.floor(Ln)),N(function(){if(!r.isClosed_){r.scriptTagHolder=new Wn(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=n.__read(e,5),o=i[0],s=i[1],a=i[2];i[3],i[4];if(r.incrementIncomingBytes_(e),r.scriptTagHolder)if(r.connectTimeoutTimer_&&(clearTimeout(r.connectTimeoutTimer_),r.connectTimeoutTimer_=null),r.everConnected_=!0,o===Cn)r.id=s,r.password=a;else{if(o!==En)throw new Error("Unrecognized command received: "+o);s?(r.scriptTagHolder.sendNewPolls=!1,r.myPacketOrderer.closeAfter(s,function(){r.onClosed_()})):r.onClosed_()}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=n.__read(e,2),o=i[0],s=i[1];r.incrementIncomingBytes_(e),r.myPacketOrderer.handleResponse(o,s)},function(){r.onClosed_()},r.urlFn);var e={};e[Cn]="t",e[In]=Math.floor(1e8*Math.random()),r.scriptTagHolder.uniqueCallbackIdentifier&&(e[Nn]=r.scriptTagHolder.uniqueCallbackIdentifier),e[z]=Y,r.transportSessionId&&(e[G]=r.transportSessionId),r.lastSessionId&&(e[Z]=r.lastSessionId),r.applicationId&&(e[ee]=r.applicationId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(J)&&(e[X]=$);var t=r.urlFn(e);r.log_("Connecting via long-poll to "+t),r.scriptTagHolder.addTag(t,function(){})}})},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!r.isNodeSdk()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!M()&&!W())},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=r.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=r.base64Encode(t),i=F(n,Fn),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!r.isNodeSdk()){this.myDisconnFrame=document.createElement("iframe");var n={};n[Dn]="t",n[bn]=e,n[Sn]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=r.stringify(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),Wn=function(){function e(t,n,i,o){if(this.onDisconnect=i,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,r.isNodeSdk())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=f(),window[wn+this.uniqueCallbackIdentifier]=t,window[Tn+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var s="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))s='<script>document.domain="'+document.domain+'";<\/script>';var a="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(h){C("frame writing exception"),h.stack&&C(h.stack),C(h)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||C("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e[bn]=this.myID,e[Sn]=this.myPW,e[In]=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+On+n.length<=kn))break;var i=this.pendingSegs.shift();n=n+"&"+Pn+r+"="+i.seg+"&"+Rn+r+"="+i.ts+"&"+xn+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(An));this.addTag(e,function(){clearTimeout(i),r()})},e.prototype.addTag=function(e,t){var n=this;r.isNodeSdk()?this.doNodeLongPoll(e,t):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){C("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}},Math.floor(1))},e}(),qn="";function Qn(e){qn=e}var Un=16384,Vn=45e3,Hn=null;"undefined"!=typeof MozWebSocket?Hn=MozWebSocket:"undefined"!=typeof WebSocket&&(Hn=WebSocket);var jn=function(){function t(e,n,r,i,o){this.connId=e,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=E(this.connId),this.stats_=hn.getCollection(n),this.connURL=t.connectionURL_(n,i,o),this.nodeAdmin=n.nodeAdmin}return t.connectionURL_=function(e,t,n){var i={};return i[z]=Y,!r.isNodeSdk()&&"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(J)&&(i[X]=$),t&&(i[G]=t),n&&(i[Z]=n),e.connectionURL(te,i)},t.prototype.open=function(t,n){var i=this;this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,c.set("previous_websocket_failure",!0);try{if(r.isNodeSdk()){var o=this.nodeAdmin?"AdminNode":"Node",s={headers:{"User-Agent":"Firebase/"+Y+"/"+qn+"/"+e.platform+"/"+o,"X-Firebase-GMPID":this.applicationId||""}},a=e.env,h=0===this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;h&&(s.proxy={origin:h}),this.mySock=new Hn(this.connURL,[],s)}else{s={headers:{"X-Firebase-GMPID":this.applicationId||""}};this.mySock=new Hn(this.connURL,[],s)}}catch(l){this.log_("Error instantiating WebSocket.");var u=l.message||l.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){i.log_("Websocket connected."),i.everConnected_=!0},this.mySock.onclose=function(){i.log_("Websocket connection was disconnected."),i.mySock=null,i.onClosed_()},this.mySock.onmessage=function(e){i.handleIncomingFrame(e)},this.mySock.onerror=function(e){i.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&i.log_(t),i.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Hn&&!t.forceDisallow_},t.previouslyFailed=function(){return c.isInMemoryStorage||!0===c.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){c.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=r.jsonEval(t);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},t.prototype.extractFrameCount_=function(e){if(r.assert(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},t.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(e){this.resetKeepAlive();var t=r.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=F(t,Un);n.length>1&&this.sendString_(String(n.length));for(var i=0;i<n.length;i++)this.sendString_(n[i])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(Vn))},t.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),Bn=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Mn,jn]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var r,i,o=jn&&jn.isAvailable(),s=o&&!jn.previouslyFailed();if(t.webSocketOnly&&(o||b("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[jn];else{var a=this.transports_=[];try{for(var h=n.__values(e.ALL_TRANSPORTS),u=h.next();!u.done;u=h.next()){var l=u.value;l&&l.isAvailable()&&a.push(l)}}catch(c){r={error:c}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),Kn=6e4,Yn=5e3,zn=10240,Gn=102400,Xn="t",$n="d",Jn="s",Zn="r",er="e",tr="o",nr="a",rr="n",ir="p",or="h",sr=function(){function e(e,t,n,r,i,o,s,a){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.onMessage_=r,this.onReady_=i,this.onDisconnect_=o,this.onKill_=s,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=E("c:"+this.id+":"),this.transportManager_=new Bn(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){e.conn_&&e.conn_.open(n,r)},Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=j(function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>Gn?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>zn?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))},Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if(Xn in e){var t=e[Xn];t===nr?this.upgradeIfSecondaryHealthy_():t===Zn?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):t===tr&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=k("t",e),n=k("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:ir,d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:nr,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:rr,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=k("t",e),n=k("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=k(Xn,e);if($n in e){var n=e[$n];if(t===or)this.onHandshake_(n);else if(t===rr){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Jn?this.onConnectionShutdown_(n):t===Zn?this.onReset_(n):t===er?w("Server Error: "+n):t===tr?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):w("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Y!==n&&b("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),j(function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())},Math.floor(Kn))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):j(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(Yn))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:ir,d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(c.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),ar=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),hr=1e3,ur=3e5,lr=3e4,cr=1.3,pr=3e4,dr="server_kill",fr=3,_r=function(e){function t(n,i,o,s,a,h,u){var l=e.call(this)||this;if(l.repoInfo_=n,l.applicationId_=i,l.onDataUpdate_=o,l.onConnectStatus_=s,l.onServerInfoUpdate_=a,l.authTokenProvider_=h,l.authOverride_=u,l.id=t.nextPersistentConnectionId_++,l.log_=E("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingPutCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=hr,l.maxReconnectDelay_=ur,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,u&&!r.isNodeSdk())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return l.scheduleConnect_(0),vn.getInstance().on("visible",l.onVisible_,l),-1===n.host.indexOf("fblocal")&&gn.getInstance().on("online",l.onOnline_,l),l}return n.__extends(t,e),t.prototype.sendRequest=function(e,t,n){var i=++this.requestNumber_,o={r:i,a:e,b:t};this.log_(r.stringify(o)),r.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),n&&(this.requestCBHash_[i]=n)},t.prototype.listen=function(e,t,n,i){var o=e.queryIdentifier(),s=e.path.toString();this.log_("Listen called for "+s+" "+o),this.listens.has(s)||this.listens.set(s,new Map),r.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),r.assert(!this.listens.get(s).has(o),"listen() called twice for same path/queryId.");var a={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(o,a),this.connected_&&this.sendListen_(a)},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r.path.toString(),o=r.queryIdentifier();this.log_("Listen on "+i+" for "+o);var s={p:i};e.tag&&(s.q=r.queryObject(),s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,function(s){var a=s.d,h=s.s;t.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(o))===e&&(n.log_("listen response",s),"ok"!==h&&n.removeListen_(i,o),e.onComplete&&e.onComplete(h,a))})},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&r.contains(e,"w")){var n=r.safeGet(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var i='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',o=t.path.toString();b("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+i+" at "+o+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||r.isAdmin(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=lr)},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=r.isValidFormat(t)?"auth":"gauth",i={cred:t};null===this.authOverride_?i.noauth=!0:"object"==typeof this.authOverride_&&(i.authvar=this.authOverride_),this.sendRequest(n,i,function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))})}},t.prototype.unlisten=function(e,t){var n=e.path.toString(),i=e.queryIdentifier();this.log_("Unlisten called for "+n+" "+i),r.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e.queryObject(),t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)})},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}})}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+r.stringify(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):w("Unrecognized action received from server: "+r.stringify(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;r.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=hr,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=hr,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>pr&&(this.reconnectDelay_=hr),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*cr)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){var e=this;if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),o=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+t.nextConnectionId_++,a=this,h=this.lastSessionId,u=!1,l=null,c=function(){l?l.close():(u=!0,o())};this.realtime_={close:c,sendRequest:function(e){r.assert(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)}};var p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(p).then(function(e){u?C("getToken() completed but was canceled"):(C("getToken() completed. Creating connection."),a.authToken_=e&&e.accessToken,l=new sr(s,a.repoInfo_,a.applicationId_,n,i,o,function(e){b(e+" ("+a.repoInfo_.toString()+")"),a.interrupt(dr)},h))}).then(null,function(t){a.log_("Failed to get token: "+t),u||(e.repoInfo_.nodeAdmin&&b(t),c())})}},t.prototype.interrupt=function(e){C("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){C("Resuming connection for reason: "+e),delete this.interruptReasons_[e],r.isEmpty(this.interruptReasons_)&&(this.reconnectDelay_=hr,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map(function(e){return O(e)}).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new B(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){C("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=fr&&(this.reconnectDelay_=lr,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,r,i;this.tryAuth();try{for(var o=n.__values(this.listens.values()),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var h=(r=void 0,n.__values(a.values())),u=h.next();!u.done;u=h.next()){var l=u.value;this.sendListen_(l)}}catch(d){r={error:d}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var c=0;c<this.outstandingPuts_.length;c++)this.outstandingPuts_[c]&&this.sendPut_(c);for(;this.onDisconnectRequestQueue_.length;){var p=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(p.action,p.pathString,p.data,p.onComplete)}},t.prototype.sendConnectStats_=function(){var e={},t="js";r.isNodeSdk()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+qn.replace(/\./g,"-")]=1,r.isMobileCordova()?e["framework.cordova"]=1:r.isReactNative()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=gn.getInstance().currentlyOnline();return r.isEmpty(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(ar),yr=function(e){function t(t,n,r){var i=e.call(this)||this;return i.repoInfo_=t,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=E("p:rest:"),i.listens_={},i}return n.__extends(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(r.assert(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())},t.prototype.listen=function(e,n,i,o){var s=this,a=e.path.toString();this.log_("Listen called for "+a+" "+e.queryIdentifier());var h=t.getListenId_(e,i),u={};this.listens_[h]=u;var l=e.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",l,function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&s.onDataUpdate_(a,n,!1,i),r.safeGet(s.listens_,h)===u)&&o(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var i=this;void 0===t&&(t={}),t.format="export",this.authTokenProvider_.getToken(!1).then(function(o){var s=o&&o.accessToken;s&&(t.auth=s);var a=(i.repoInfo_.secure?"https://":"http://")+i.repoInfo_.host+e+"?ns="+i.repoInfo_.namespace+r.querystring(t);i.log_("Sending REST request for "+a);var h=new XMLHttpRequest;h.onreadystatechange=function(){if(n&&4===h.readyState){i.log_("REST Response for "+a+" received. status:",h.status,"response:",h.responseText);var e=null;if(h.status>=200&&h.status<300){try{e=r.jsonEval(h.responseText)}catch(t){b("Failed to parse JSON response for "+a+": "+h.responseText)}n(null,e)}else 401!==h.status&&404!==h.status&&b("Got unsuccessful REST response for "+a+" Status: "+h.status),n(h.status);n=null}},h.open("GET",a,!0),h.send()})},t}(ar),vr="repo_interrupt",gr=function(){function e(e,t,n,i){var o=this;if(this.repoInfo_=e,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new fn,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new Dt,this.persistentConnection_=null,this.stats_=hn.getCollection(e),t||H())this.server_=new yr(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var s=n.options.databaseAuthVariableOverride;if(null!=s){if("object"!=typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{r.stringify(s)}catch(a){throw new Error("Invalid authOverride provided: "+a)}}this.persistentConnection_=new _r(this.repoInfo_,n.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,s),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(e){o.server_.refreshAuthToken(e)}),this.statsReporter_=hn.getOrCreateReporter(e,function(){return new dn(o.stats_,o.server_)}),this.transactionsInit_(),this.infoData_=new sn,this.infoSyncTree_=new on({startListening:function(e,t,n,r){var i=[],s=o.infoData_.getNode(e.path);return s.isEmpty()||(i=o.infoSyncTree_.applyServerOverwrite(e.path,s),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new on({startListening:function(e,t,n,r){return o.server_.listen(e,n,t,function(t,n){var i=r(t,n);o.eventQueue_.raiseEventsForChangedPath(e.path,i)}),[]},stopListening:function(e,t){o.server_.unlisten(e,t)}})}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e.prototype.name=function(){return this.repoInfo_.namespace},e.prototype.serverTime=function(){var e=this.infoData_.getNode(new B(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e},e.prototype.generateServerValues=function(){return Tt({timestamp:this.serverTime()})},e.prototype.onDataUpdate_=function(e,t,n,i){this.dataUpdateCount++;var o=new B(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var s=[];if(i)if(n){var a=r.map(t,function(e){return lt(e)});s=this.serverSyncTree_.applyTaggedQueryMerge(o,a,i)}else{var h=lt(t);s=this.serverSyncTree_.applyTaggedQueryOverwrite(o,h,i)}else if(n){var u=r.map(t,function(e){return lt(e)});s=this.serverSyncTree_.applyServerMerge(o,u)}else{var l=lt(t);s=this.serverSyncTree_.applyServerOverwrite(o,l)}var c=o;s.length>0&&(c=this.rerunTransactions_(o)),this.eventQueue_.raiseEventsForChangedPath(c,s)},e.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},e.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},e.prototype.onServerInfoUpdate_=function(e){var t=this;A(e,function(e,n){t.updateInfo_(e,n)})},e.prototype.updateInfo_=function(e,t){var n=new B("/.info/"+e),r=lt(t);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},e.prototype.getNextWriteId_=function(){return this.nextWriteId_++},e.prototype.setWithPriority=function(e,t,n,r){var i=this;this.log_("set",{path:e.toString(),value:t,priority:n});var o=this.generateServerValues(),s=lt(t,n),a=this.serverSyncTree_.calcCompleteEventCache(e),h=Pt(s,a,o),u=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserOverwrite(e,h,u,!0);this.eventQueue_.queueEvents(l),this.server_.put(e.toString(),s.val(!0),function(t,n){var o="ok"===t;o||b("set at "+e+" failed: "+t);var s=i.serverSyncTree_.ackUserWrite(u,!o);i.eventQueue_.raiseEventsForChangedPath(e,s),i.callOnCompleteCallback(r,t,n)});var c=this.abortTransactions_(e);this.rerunTransactions_(c),this.eventQueue_.raiseEventsForChangedPath(c,[])},e.prototype.update=function(e,t,n){var r=this;this.log_("update",{path:e.toString(),value:t});var i=!0,o=this.generateServerValues(),s={};if(A(t,function(t,n){i=!1,s[t]=Nt(e.child(t),lt(n),r.serverSyncTree_,o)}),i)C("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var a=this.getNextWriteId_(),h=this.serverSyncTree_.applyUserMerge(e,s,a);this.eventQueue_.queueEvents(h),this.server_.merge(e.toString(),t,function(t,i){var o="ok"===t;o||b("update at "+e+" failed: "+t);var s=r.serverSyncTree_.ackUserWrite(a,!o),h=s.length>0?r.rerunTransactions_(e):e;r.eventQueue_.raiseEventsForChangedPath(h,s),r.callOnCompleteCallback(n,t,i)}),A(t,function(t){var n=r.abortTransactions_(e.child(t));r.rerunTransactions_(n)}),this.eventQueue_.raiseEventsForChangedPath(e,[])}},e.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),n=new Dt;this.onDisconnect_.forEachTree(B.Empty,function(r,i){var o=Nt(r,i,e.serverSyncTree_,t);n.remember(r,o)});var r=[];n.forEachTree(B.Empty,function(t,n){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,n));var i=e.abortTransactions_(t);e.rerunTransactions_(i)}),this.onDisconnect_=new Dt,this.eventQueue_.raiseEventsForChangedPath(B.Empty,r)},e.prototype.onDisconnectCancel=function(e,t){var n=this;this.server_.onDisconnectCancel(e.toString(),function(r,i){"ok"===r&&n.onDisconnect_.forget(e),n.callOnCompleteCallback(t,r,i)})},e.prototype.onDisconnectSet=function(e,t,n){var r=this,i=lt(t);this.server_.onDisconnectPut(e.toString(),i.val(!0),function(t,o){"ok"===t&&r.onDisconnect_.remember(e,i),r.callOnCompleteCallback(n,t,o)})},e.prototype.onDisconnectSetWithPriority=function(e,t,n,r){var i=this,o=lt(t,n);this.server_.onDisconnectPut(e.toString(),o.val(!0),function(t,n){"ok"===t&&i.onDisconnect_.remember(e,o),i.callOnCompleteCallback(r,t,n)})},e.prototype.onDisconnectUpdate=function(e,t,n){var i=this;if(r.isEmpty(t))return C("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(e.toString(),t,function(r,o){"ok"===r&&A(t,function(t,n){var r=lt(n);i.onDisconnect_.remember(e.child(t),r)}),i.callOnCompleteCallback(n,r,o)})},e.prototype.addEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.removeEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(vr)},e.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(vr)},e.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var t;e?(this.statsListener_||(this.statsListener_=new un(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var n=Object.keys(t).reduce(function(e,t){return Math.max(t.length,e)},0);A(t,function(e,t){for(var r=e,i=e.length;i<n+2;i++)r+=" ";console.log(r+t)})}},e.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},e.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r="";this.persistentConnection_&&(r=this.persistentConnection_.id+":"),C.apply(void 0,n.__spread([r],e))},e.prototype.callOnCompleteCallback=function(e,t,n){e&&V(function(){if("ok"===t)e(null);else{var r=(t||"error").toUpperCase(),i=r;n&&(i+=": "+n);var o=new Error(i);o.code=r,e(o)}})},Object.defineProperty(e.prototype,"database",{get:function(){return this.__database||(this.__database=new Dr(this))},enumerable:!1,configurable:!0}),e}(),mr=function(){function e(t){this.indexedFilter_=new jt(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new ke(t,n))||(n=st.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=st.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(st.EMPTY_NODE);var i=this;return t.forEachChild(ze,function(e,t){i.matches(new ke(e,t))||(r=r.updateImmediateChild(e,st.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),Cr=function(){function e(e){this.rangedFilter_=new mr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new ke(t,n))||(n=st.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=st.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=st.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(st.EMPTY_NODE);var a=void 0,h=void 0,u=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),h=this.rangedFilter_.getStartPost();var l=this.index_.getCompare();u=function(e,t){return l(t,e)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),h=this.rangedFilter_.getEndPost(),u=this.index_.getCompare();o=0;for(var c=!1;i.hasNext();){s=i.getNext();!c&&u(a,s)<=0&&(c=!0),c&&o<this.limit_&&u(s,h)<=0?o++:r=r.updateImmediateChild(s.name,st.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,i,o){var s;if(this.reverse_){var a=this.index_.getCompare();s=function(e,t){return a(t,e)}}else s=this.index_.getCompare();var h=e;r.assert(h.numChildren()===this.limit_,"");var u=new ke(t,n),l=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),c=this.rangedFilter_.matches(u);if(h.hasChild(t)){for(var p=h.getImmediateChild(t),d=i.getChildAfterChild(this.index_,l,this.reverse_);null!=d&&(d.name===t||h.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);var f=null==d?1:s(d,u);if(c&&!n.isEmpty()&&f>=0)return null!=o&&o.trackChildChange(Ht.childChangedChange(t,n,p)),h.updateImmediateChild(t,n);null!=o&&o.trackChildChange(Ht.childRemovedChange(t,p));var _=h.updateImmediateChild(t,st.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=o&&o.trackChildChange(Ht.childAddedChange(d.name,d.node)),_.updateImmediateChild(d.name,d.node)):_}return n.isEmpty()?e:c&&s(l,u)>=0?(null!=o&&(o.trackChildChange(Ht.childRemovedChange(l.name,l.node)),o.trackChildChange(Ht.childAddedChange(t,n))),h.updateImmediateChild(t,n).updateImmediateChild(l.name,st.EMPTY_NODE)):e},e}(),Er=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ze}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},e.prototype.getIndexStartValue=function(){return r.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return r.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:P},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return r.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return r.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:R},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return r.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.copy_=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},e.prototype.limitToFirst=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},e.prototype.limitToLast=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},e.prototype.startAt=function(e,t){var n=this.copy_();return n.startSet_=!0,void 0===e&&(e=null),n.indexStartValue_=e,null!=t?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n},e.prototype.endAt=function(e,t){var n=this.copy_();return n.endSet_=!0,void 0===e&&(e=null),n.indexEndValue_=e,void 0!==t?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n},e.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},e.prototype.getQueryObject=function(){var t=e.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[t.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),n[t.VIEW_FROM]=r}return this.index_!==ze&&(n[t.INDEX]=this.index_.toString()),n},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===ze},e.prototype.getNodeFilter=function(){return this.loadsAllData()?new jt(this.getIndex()):this.hasLimit()?new Cr(this):new mr(this)},e.prototype.toRestQueryStringParameters=function(){var t,n=e.REST_QUERY_CONSTANTS_,i={};return this.isDefault()?i:(this.index_===ze?t=n.PRIORITY_INDEX:this.index_===dt?t=n.VALUE_INDEX:this.index_===Ae?t=n.KEY_INDEX:(r.assert(this.index_ instanceof ft,"Unrecognized index type!"),t=this.index_.toString()),i[n.ORDER_BY]=r.stringify(t),this.startSet_&&(i[n.START_AT]=r.stringify(this.indexStartValue_),this.startNameSet_&&(i[n.START_AT]+=","+r.stringify(this.indexStartName_))),this.endSet_&&(i[n.END_AT]=r.stringify(this.indexEndValue_),this.endNameSet_&&(i[n.END_AT]+=","+r.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?i[n.LIMIT_TO_FIRST]=this.limit_:i[n.LIMIT_TO_LAST]=this.limit_),i)},e.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},e.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},e.DEFAULT=new e,e}(),wr=function(e){function t(t,n){if(!(t instanceof gr))throw new Error("new Reference() no longer supported - use app.database().");return e.call(this,t,n,Er.DEFAULT,!1)||this}return n.__extends(t,e),t.prototype.getKey=function(){return r.validateArgCount("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},t.prototype.child=function(e){return r.validateArgCount("Reference.child",1,1,arguments.length),"number"==typeof e?e=String(e):e instanceof B||(null===this.path.getFront()?Se("Reference.child",1,e,!1):be("Reference.child",1,e,!1)),new t(this.repo,this.path.child(e))},t.prototype.getParent=function(){r.validateArgCount("Reference.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new t(this.repo,e)},t.prototype.getRoot=function(){r.validateArgCount("Reference.root",0,0,arguments.length);for(var e=this;null!==e.getParent();)e=e.getParent();return e},t.prototype.databaseProp=function(){return this.repo.database},t.prototype.set=function(e,t){r.validateArgCount("Reference.set",1,2,arguments.length),Ie("Reference.set",this.path),ve("Reference.set",1,e,this.path,!1),r.validateCallback("Reference.set",2,t,!0);var n=new r.Deferred;return this.repo.setWithPriority(this.path,e,null,n.wrapCallback(t)),n.promise},t.prototype.update=function(e,t){if(r.validateArgCount("Reference.update",1,2,arguments.length),Ie("Reference.update",this.path),Array.isArray(e)){for(var n={},i=0;i<e.length;++i)n[""+i]=e[i];e=n,b("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ce("Reference.update",1,e,this.path,!1),r.validateCallback("Reference.update",2,t,!0);var o=new r.Deferred;return this.repo.update(this.path,e,o.wrapCallback(t)),o.promise},t.prototype.setWithPriority=function(e,t,n){if(r.validateArgCount("Reference.setWithPriority",2,3,arguments.length),Ie("Reference.setWithPriority",this.path),ve("Reference.setWithPriority",1,e,this.path,!1),Ee("Reference.setWithPriority",2,t,!1),r.validateCallback("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var i=new r.Deferred;return this.repo.setWithPriority(this.path,e,t,i.wrapCallback(n)),i.promise},t.prototype.remove=function(e){return r.validateArgCount("Reference.remove",0,1,arguments.length),Ie("Reference.remove",this.path),r.validateCallback("Reference.remove",1,e,!0),this.set(null,e)},t.prototype.transaction=function(e,t,n){if(r.validateArgCount("Reference.transaction",1,3,arguments.length),Ie("Reference.transaction",this.path),r.validateCallback("Reference.transaction",1,e,!1),r.validateCallback("Reference.transaction",2,t,!0),Pe("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var i=new r.Deferred;"function"==typeof t&&i.promise.catch(function(){});return this.repo.startTransaction(this.path,e,function(e,n,r){e?i.reject(e):i.resolve(new xe(n,r)),"function"==typeof t&&t(e,n,r)},n),i.promise},t.prototype.setPriority=function(e,t){r.validateArgCount("Reference.setPriority",1,2,arguments.length),Ie("Reference.setPriority",this.path),Ee("Reference.setPriority",1,e,!1),r.validateCallback("Reference.setPriority",2,t,!0);var n=new r.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),e,null,n.wrapCallback(t)),n.promise},t.prototype.push=function(e,t){r.validateArgCount("Reference.push",0,2,arguments.length),Ie("Reference.push",this.path),ve("Reference.push",1,e,this.path,!0),r.validateCallback("Reference.push",2,t,!0);var n,i=this.repo.serverTime(),o=De(i),s=this.child(o),a=this.child(o);return n=null!=e?s.set(e,t).then(function(){return a}):Promise.resolve(a),s.then=n.then.bind(n),s.catch=n.then.bind(n,void 0),"function"==typeof t&&n.catch(function(){}),s},t.prototype.onDisconnect=function(){return Ie("Reference.onDisconnect",this.path),new Re(this.repo,this.path)},Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(Ct);Ct.__referenceConstructor=wr,Zt.__referenceConstructor=wr;var Tr,br=function(){return function(){this.children={},this.childCount=0,this.value=null}}(),Sr=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n=new br),this.name_=e,this.parent_=t,this.node_=n}return e.prototype.subTree=function(t){for(var n=t instanceof B?t:new B(t),i=this,o=n.getFront();null!==o;){i=new e(o,i,r.safeGet(i.node_.children,o)||new br),o=(n=n.popFront()).getFront()}return i},e.prototype.getValue=function(){return this.node_.value},e.prototype.setValue=function(e){r.assert(void 0!==e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},e.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},e.prototype.hasChildren=function(){return this.node_.childCount>0},e.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},e.prototype.forEachChild=function(t){var n=this;A(this.node_.children,function(r,i){t(new e(r,n,i))})},e.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},e.prototype.forEachAncestor=function(e,t){for(var n=t?this:this.parent();null!==n;){if(e(n))return!0;n=n.parent()}return!1},e.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},e.prototype.path=function(){return new B(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},e.prototype.name=function(){return this.name_},e.prototype.parent=function(){return this.parent_},e.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},e.prototype.updateChild_=function(e,t){var n=t.isEmpty(),i=r.contains(this.node_.children,e);n&&i?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):n||i||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},e}();!function(e){e[e.RUN=0]="RUN",e[e.SENT=1]="SENT",e[e.COMPLETED=2]="COMPLETED",e[e.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",e[e.NEEDS_ABORT=4]="NEEDS_ABORT"}(Tr||(Tr={})),gr.MAX_TRANSACTION_RETRIES_=25,gr.prototype.transactionsInit_=function(){this.transactionQueueTree_=new Sr},gr.prototype.startTransaction=function(e,t,n,i){this.log_("transaction on "+e);var o=function(){},s=new wr(this,e);s.on("value",o);var a={path:e,update:t,onComplete:n,status:null,order:f(),applyLocally:i,retryCount:0,unwatcher:function(){s.off("value",o)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=this.getLatestState_(e);a.currentInputSnapshot=h;var u=a.update(h.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var l=new _t(a.currentInputSnapshot,new wr(this,a.path),ze);a.onComplete(null,!1,l)}}else{ge("transaction failed: Data returned ",u,a.path),a.status=Tr.RUN;var c=this.transactionQueueTree_.subTree(e),p=c.getValue()||[];p.push(a),c.setValue(p);var d=void 0;if("object"==typeof u&&null!==u&&r.contains(u,".priority"))d=r.safeGet(u,".priority"),r.assert(ye(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else d=(this.serverSyncTree_.calcCompleteEventCache(e)||st.EMPTY_NODE).getPriority().val();d=d;var _=this.generateServerValues(),y=lt(u,d),v=Pt(y,h,_);a.currentOutputSnapshotRaw=y,a.currentOutputSnapshotResolved=v,a.currentWriteId=this.getNextWriteId_();var g=this.serverSyncTree_.applyUserOverwrite(e,v,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,g),this.sendReadyTransactions_()}},gr.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||st.EMPTY_NODE},gr.prototype.sendReadyTransactions_=function(e){var t=this;if(void 0===e&&(e=this.transactionQueueTree_),e||this.pruneCompletedTransactionsBelowNode_(e),null!==e.getValue()){var n=this.buildTransactionQueue_(e);r.assert(n.length>0,"Sending zero length transaction queue"),n.every(function(e){return e.status===Tr.RUN})&&this.sendTransactionQueue_(e.path(),n)}else e.hasChildren()&&e.forEachChild(function(e){t.sendReadyTransactions_(e)})},gr.prototype.sendTransactionQueue_=function(e,t){for(var n=this,i=t.map(function(e){return e.currentWriteId}),o=this.getLatestState_(e,i),s=o,a=o.hash(),h=0;h<t.length;h++){var u=t[h];r.assert(u.status===Tr.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=Tr.SENT,u.retryCount++;var l=B.relativePath(e,u.path);s=s.updateChild(l,u.currentOutputSnapshotRaw)}var c=s.val(!0),p=e;this.server_.put(p.toString(),c,function(r){n.log_("transaction put response",{path:p.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=0;s<t.length;s++){if(t[s].status=Tr.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(t[s].currentWriteId)),t[s].onComplete){var a=t[s].currentOutputSnapshotResolved,h=new wr(n,t[s].path),u=new _t(a,h,ze);o.push(t[s].onComplete.bind(null,null,!0,u))}t[s].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(e)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(e,i);for(s=0;s<o.length;s++)V(o[s])}else{if("datastale"===r)for(s=0;s<t.length;s++)t[s].status===Tr.SENT_NEEDS_ABORT?t[s].status=Tr.NEEDS_ABORT:t[s].status=Tr.RUN;else{b("transaction at "+p.toString()+" failed: "+r);for(s=0;s<t.length;s++)t[s].status=Tr.NEEDS_ABORT,t[s].abortReason=r}n.rerunTransactions_(e)}},a)},gr.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),n=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,n),n},gr.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var n,i=[],o=[],s=e.filter(function(e){return e.status===Tr.RUN}).map(function(e){return e.currentWriteId}),a=0;a<e.length;a++){var h=e[a],u=B.relativePath(t,h.path),l=!1,c=void 0;if(r.assert(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),h.status===Tr.NEEDS_ABORT)l=!0,c=h.abortReason,o=o.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0));else if(h.status===Tr.RUN)if(h.retryCount>=gr.MAX_TRANSACTION_RETRIES_)l=!0,c="maxretry",o=o.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0));else{var p=this.getLatestState_(h.path,s);h.currentInputSnapshot=p;var d=e[a].update(p.val());if(void 0!==d){ge("transaction failed: Data returned ",d,h.path);var f=lt(d);"object"==typeof d&&null!=d&&r.contains(d,".priority")||(f=f.updatePriority(p.getPriority()));var _=h.currentWriteId,y=this.generateServerValues(),v=Pt(f,p,y);h.currentOutputSnapshotRaw=f,h.currentOutputSnapshotResolved=v,h.currentWriteId=this.getNextWriteId_(),s.splice(s.indexOf(_),1),o=(o=o.concat(this.serverSyncTree_.applyUserOverwrite(h.path,v,h.currentWriteId,h.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(_,!0))}else l=!0,c="nodata",o=o.concat(this.serverSyncTree_.ackUserWrite(h.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(t,o),o=[],l&&(e[a].status=Tr.COMPLETED,n=e[a].unwatcher,setTimeout(n,Math.floor(0)),e[a].onComplete))if("nodata"===c){var g=new wr(this,e[a].path),m=e[a].currentInputSnapshot,C=new _t(m,g,ze);i.push(e[a].onComplete.bind(null,null,!1,C))}else i.push(e[a].onComplete.bind(null,new Error(c),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<i.length;a++)V(i[a]);this.sendReadyTransactions_()}},gr.prototype.getAncestorTransactionNode_=function(e){var t,n=this.transactionQueueTree_;for(t=e.getFront();null!==t&&null===n.getValue();)n=n.subTree(t),t=(e=e.popFront()).getFront();return n},gr.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort(function(e,t){return e.order-t.order}),t},gr.prototype.aggregateTransactionQueuesForNode_=function(e,t){var n=this,r=e.getValue();if(null!==r)for(var i=0;i<r.length;i++)t.push(r[i]);e.forEachChild(function(e){n.aggregateTransactionQueuesForNode_(e,t)})},gr.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this,n=e.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==Tr.COMPLETED&&(n[r]=n[i],r++);n.length=r,e.setValue(n.length>0?n:null)}e.forEachChild(function(e){t.pruneCompletedTransactionsBelowNode_(e)})},gr.prototype.abortTransactions_=function(e){var t=this,n=this.getAncestorTransactionNode_(e).path(),r=this.transactionQueueTree_.subTree(e);return r.forEachAncestor(function(e){t.abortTransactionsOnNode_(e)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(e){t.abortTransactionsOnNode_(e)}),n},gr.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var n=[],i=[],o=-1,s=0;s<t.length;s++)if(t[s].status===Tr.SENT_NEEDS_ABORT);else if(t[s].status===Tr.SENT)r.assert(o===s-1,"All SENT items should be at beginning of queue."),o=s,t[s].status=Tr.SENT_NEEDS_ABORT,t[s].abortReason="set";else if(r.assert(t[s].status===Tr.RUN,"Unexpected transaction status in abort"),t[s].unwatcher(),i=i.concat(this.serverSyncTree_.ackUserWrite(t[s].currentWriteId,!0)),t[s].onComplete){n.push(t[s].onComplete.bind(null,new Error("set"),!1,null))}-1===o?e.setValue(null):t.length=o+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),i);for(s=0;s<n.length;s++)V(n[s])}};var Ir,Nr=function(){function e(e,t){var n=this;this.app_=e,this.authProvider_=t,this.auth_=null,this.auth_=t.getImmediate({optional:!0}),this.auth_||t.get().then(function(e){return n.auth_=e})}return e.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch(function(e){return e&&"auth/token-not-initialized"===e.code?(C("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)}):Promise.resolve(null)},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout(function(){return e(null)},0),this.authProvider_.get().then(function(t){return t.addAuthTokenListener(e)}))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then(function(t){return t.removeAuthTokenListener(e)})},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',b(e)},e}(),Pr=function(){function e(){}return e.prototype.getToken=function(t){return Promise.resolve({accessToken:e.EMULATOR_AUTH_TOKEN})},e.prototype.addTokenChangeListener=function(t){t(e.EMULATOR_AUTH_TOKEN)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.EMULATOR_AUTH_TOKEN="owner",e}(),Rr="FIREBASE_DATABASE_EMULATOR_HOST",xr=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return Ir||(Ir=new t),Ir},t.prototype.interrupt=function(){var e,t,r,i;try{for(var o=n.__values(Object.keys(this.repos_)),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var h=(r=void 0,n.__values(Object.keys(this.repos_[a]))),u=h.next();!u.done;u=h.next()){var l=u.value;this.repos_[a][l].interrupt()}}catch(c){r={error:c}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.prototype.resume=function(){var e,t,r,i;try{for(var o=n.__values(Object.keys(this.repos_)),s=o.next();!s.done;s=o.next()){var a=s.value;try{for(var h=(r=void 0,n.__values(Object.keys(this.repos_[a]))),u=h.next();!u.done;u=h.next()){var l=u.value;this.repos_[a][l].resume()}}catch(c){r={error:c}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},t.prototype.databaseFromApp=function(t,n,r,i){var o=r||t.options.databaseURL;void 0===o&&(t.options.projectId||T("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),C("Using default host for project ",t.options.projectId),o=t.options.projectId+"-default-rtdb.firebaseio.com");var s,a=he(o,i),h=a.repoInfo,u=void 0;void 0!==e&&(u=e.env[Rr]),u?(s=!0,o="http://"+u+"?ns="+h.namespace,h=(a=he(o,i)).repoInfo):s=!a.repoInfo.secure;var l=i&&s?new Pr:new Nr(t,n);return Ne("Invalid Firebase Database URL",1,a),a.path.isEmpty()||T("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(h,t,l).database},t.prototype.deleteRepo=function(e){var t=r.safeGet(this.repos_,e.app.name);t&&r.safeGet(t,e.repoInfo_.toURLString())===e||T("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.repoInfo_.toURLString()]},t.prototype.createRepo=function(e,t,n){var i=r.safeGet(this.repos_,t.name);i||(i={},this.repos_[t.name]=i);var o=r.safeGet(i,e.toURLString());return o&&T("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new gr(e,this.useRestClient_,t,n),i[e.toURLString()]=o,o},t.prototype.forceRestClient=function(e){this.useRestClient_=e},t}(),Dr=function(){function e(e){this.repo_=e,e instanceof gr||T("Don't call new Database() directly - please use firebase.database()."),this.root_=new wr(e,B.Empty),this.INTERNAL=new kr(this)}return Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),e.prototype.ref=function(e){return this.checkDeleted_("ref"),r.validateArgCount("database.ref",0,1,arguments.length),e instanceof wr?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),r.validateArgCount(t,1,1,arguments.length);var n=he(e,this.repo_.repoInfo_.nodeAdmin);Ne(t,1,n);var i=n.repoInfo;return i.host!==this.repo_.repoInfo_.host&&T(t+": Host name does not match the current database: (found "+i.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},e.prototype.checkDeleted_=function(e){null===this.repo_&&T("Cannot call "+e+" on a deleted database.")},e.prototype.goOffline=function(){r.validateArgCount("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},e.prototype.goOnline=function(){r.validateArgCount("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},e.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},e}(),kr=function(){function e(e){this.database=e}return e.prototype.delete=function(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){return this.database.checkDeleted_("delete"),xr.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},e}(),Or=function(){jn.forceDisallow(),Mn.forceAllow()},Fr=function(){Mn.forceDisallow()},Ar=function(){return jn.isAvailable()},Lr=function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},Mr=function(e,t){e.repo.stats(t)},Wr=function(e,t){e.repo.statsIncrementCounter(t)},qr=function(e){return e.repo.dataUpdateCount},Qr=function(e,t){return e.repo.interceptServerData_(t)},Ur=Object.freeze({__proto__:null,forceLongPolling:Or,forceWebSockets:Fr,isWebSocketsAvailable:Ar,setSecurityDebugCallback:Lr,stats:Mr,statsIncrementCounter:Wr,dataUpdateCount:qr,interceptServerData:Qr}),Vr=_r;_r.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},_r.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Hr=sr,jr=function(e){var t=_r.prototype.put;return _r.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){_r.prototype.put=t}},Br=re,Kr=function(e){return e.queryIdentifier()},Yr=function(e){xr.getInstance().forceRestClient(e)},zr=Object.freeze({__proto__:null,DataConnection:Vr,RealTimeConnection:Hr,hijackHash:jr,ConnectionTarget:Br,queryIdentifier:Kr,forceRestClient:Yr}),Gr="@firebase/database",Xr="0.6.13",$r=Dr.ServerValue;function Jr(e){Qn(e.SDK_VERSION);var t=e.INTERNAL.registerComponent(new o.Component("database",function(e,t){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal");return xr.getInstance().databaseFromApp(n,r,t)},"PUBLIC").setServiceProps({Reference:wr,Query:Ct,Database:Dr,DataSnapshot:_t,enableLogging:m,INTERNAL:Ur,ServerValue:$r,TEST_ACCESS:zr}).setMultipleInstances(!0));e.registerVersion(Gr,Xr),r.isNodeSdk()&&(module.exports=t)}Jr(a.default),exports.DataSnapshot=_t,exports.Database=Dr,exports.OnDisconnect=Re,exports.Query=Ct,exports.Reference=wr,exports.ServerValue=$r,exports.enableLogging=m,exports.registerDatabase=Jr;
},{"@firebase/app":"QzTI","tslib":"CvJj","@firebase/util":"rrEo","@firebase/logger":"srlT","@firebase/component":"YHdR","process":"g5IB"}],"hCmk":[function(require,module,exports) {
"use strict";require("@firebase/database");
},{"@firebase/database":"ekyg"}],"LMN3":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(r){if(r&&r.__esModule)return r;var a={};if(null!=r)for(var n in r)"default"!==n&&Object.hasOwnProperty.call(r,n)&&e(a,r,n);return t(a,r),a};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Game=void 0;var a=require("./managers/CampManager"),n=require("./managers/EventManager"),i=require("./managers/GameOverManager"),o=require("./managers/RipManager"),s=require("./managers/TravelManager"),c=require("./managers/LogManager"),g=require("./managers/BagManager"),u=require("./managers/StateManager"),h=require("./enums/GameStates"),d=require("./managers/CharacterManager"),l=require("./entities/Clock"),p=r(require("firebase/app")),m=require("./seeds/ItemSeeds"),f=require("./managers/DiceManager"),y=require("./managers/SkillCheckManager"),M=require("./managers/ItemPickerManager");require("firebase/database");var b=function(){function e(){this._currentDay=1,this._hours=0,this._distanceToTheBorder=300,this.travelPage=document.getElementById("travel-page"),this.logPage=document.getElementById("log-page"),this.campPage=document.getElementById("camp-page"),this.eventPage=document.getElementById("event-page"),this.skillCheckPage=document.getElementById("skill-check-page"),this.gameOverPage=document.getElementById("game-over-page"),this.ripPage=document.getElementById("rip-page"),this.bagPage=document.getElementById("bag-page"),this.itemPickerPage=document.getElementById("item-picker-page"),this._currentTimeField=document.querySelector("#current-time-field"),this.playerGuid=this.generateGuid()}return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.start=function(){(new f.DiceManager).start(),this.bagManager=new g.BagManager,this.characterManager=new d.CharacterManager,this.characterManager.start(),this.campManager=new a.CampManager,this.eventManager=new n.EventManager,this.gameOverManager=new i.GameOverManager,this.skillCheckManager=new y.SkillCheckManager,this.ripManager=new o.RipManager,this.travelManager=new s.TravelManager,this._clock=new l.Clock(8,!0),this.logManager=new c.LogManager,this.stateManager=new u.StateManager,this.itemPickerManager=new M.ItemPickerManager,this.showDataTime(),this.stateManager.goToState(h.GameStates.TRAVEL),this.startFirebase()},Object.defineProperty(e.prototype,"events",{get:function(){return this.eventManager},enumerable:!1,configurable:!0}),e.prototype.startFirebase=function(){p.initializeApp({apiKey:"AIzaSyBgdfo0fzhb_Meli1pcIhUb-qimpce-_WA",authDomain:"getout-a2360.firebaseapp.com",databaseURL:"https://getout-a2360.firebaseio.com",projectId:"getout-a2360",storageBucket:"getout-a2360.appspot.com",messagingSenderId:"995739637479",appId:"1:995739637479:web:fc4723344bae88ff317442",measurementId:"G-D8S0K3NWFV"})},e.prototype.addLogToFirebase=function(e){p.database().ref("logs/"+this.playerGuid).push().set(e).then(function(e){console.log("Document written with log")}).catch(function(e){console.error("Error adding document: ",e)})},Object.defineProperty(e.prototype,"log",{get:function(){return this.logManager},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hours",{get:function(){return this._hours},set:function(e){this._hours=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentDay",{get:function(){return this._currentDay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"distanceToTheBorder",{get:function(){return this._distanceToTheBorder},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"characters",{get:function(){return this.characterManager.characters},enumerable:!1,configurable:!0}),e.prototype.decreaseTheDistanceToTheBorder=function(e){this._distanceToTheBorder-=e},e.prototype.addDaysToCurrentDay=function(e){this._currentDay+=e},e.prototype.addItemsToBag=function(){for(var e=0;e<10;e++)this.bagManager.putItem(m.ItemSeeds.getOneRandomItem())},e.prototype.showPage=function(e){e.style.display="flex"},e.prototype.hidePage=function(e){e.style.display="none"},e.prototype.hideAllPages=function(){this.hidePage(this.travelPage),this.hidePage(this.logPage),this.hidePage(this.campPage),this.hidePage(this.eventPage),this.hidePage(this.skillCheckPage),this.hidePage(this.gameOverPage),this.hidePage(this.bagPage),this.hidePage(this.ripPage),this.hidePage(this.itemPickerPage)},e.prototype.showDataTime=function(){this._currentTimeField.innerHTML=this._clock.showTime()+" - day "+this._currentDay,this._clock.anteMeridiem?this._clock.currentHour>6&&this._clock.currentHour<12?this._currentTimeField.innerHTML+=" - daylight":this._currentTimeField.innerHTML+=" - night":this._clock.currentHour>6&&this._clock.currentHour<12?this._currentTimeField.innerHTML+=" - night":this._currentTimeField.innerHTML+=" - daylight"},e.prototype.passOneHour=function(){12==this._clock.currentHour&&this._clock.anteMeridiem&&this.addDaysToCurrentDay(1),this._clock.nextHour(),this.showDataTime()},e.prototype.generateGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},e.prototype.getRandomArbitrary=function(e){return Math.floor(Math.random()*e)},e}();exports.Game=b;
},{"./managers/CampManager":"xGbl","./managers/EventManager":"XVIc","./managers/GameOverManager":"te8u","./managers/RipManager":"NjyG","./managers/TravelManager":"B4ph","./managers/LogManager":"pbwm","./managers/BagManager":"hQTy","./managers/StateManager":"G1mS","./enums/GameStates":"M2Er","./managers/CharacterManager":"vgbH","./entities/Clock":"XxXA","firebase/app":"YEwQ","./seeds/ItemSeeds":"fBPN","./managers/DiceManager":"hFLE","./managers/SkillCheckManager":"Qoi8","./managers/ItemPickerManager":"zegf","firebase/database":"hCmk"}],"B6dB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./Game"),t=e.Game.getInstance();t.start();
},{"./Game":"LMN3"}]},{},["B6dB"], null)
//# sourceMappingURL=src.eceec5a8.js.map